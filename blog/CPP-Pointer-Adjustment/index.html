<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="twitter:image:src" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>C++ Pointer Adjustment - Lei Mao&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Lei Mao&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lei Mao&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/images/favicon/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="512x512" href="/images/favicon/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="apple-touch-icon" sizes="32x32" href="/images/favicon/favicon-32x32.png"><meta name="description" content="Fundamentals for C++ Runtime Polymorphism"><meta property="og:type" content="blog"><meta property="og:title" content="C++ Pointer Adjustment"><meta property="og:url" content="https://levanliu.github.io/blog/CPP-Pointer-Adjustment/"><meta property="og:site_name" content="Lei Mao&#039;s Log Book"><meta property="og:description" content="Fundamentals for C++ Runtime Polymorphism"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta property="article:published_time" content="2023-06-26T07:00:00.000Z"><meta property="article:modified_time" content="2023-06-26T07:00:00.000Z"><meta property="article:author" content="Lei Mao"><meta property="article:tag" content="Programming"><meta property="article:tag" content="C++"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta property="twitter:creator" content="@matchaleimao"><meta property="twitter:site" content="Lei Mao&#039;s Log Book"><meta property="fb:admins" content="dukeleimao"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://levanliu.github.io/blog/CPP-Pointer-Adjustment/"},"headline":"C++ Pointer Adjustment","image":["https://levanliu.github.io/images/favicon/android-chrome-512x512.png"],"datePublished":"2023-06-26T07:00:00.000Z","dateModified":"2023-06-26T07:00:00.000Z","author":{"@type":"Person","name":"Lei Mao"},"publisher":{"@type":"Organization","name":"Lei Mao's Log Book","logo":{"@type":"ImageObject","url":"https://levanliu.github.io/images/favicon/android-chrome-512x512.png"}},"description":"Fundamentals for C++ Runtime Polymorphism"}</script><link rel="canonical" href="https://levanliu.github.io/blog/CPP-Pointer-Adjustment/"><link rel="alternate" href="/atom.xml" title="Lei Mao&#039;s Log Book" type="application/atom+xml"><link rel="icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=PT+Sans+Narrow:wght@400;700&amp;family=PT+Serif"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-EJY6FXZBCB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-EJY6FXZBCB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script src="//m.servedby-buysellads.com/monetization.custom.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Lei Mao&#039;s Log Book</a><a class="navbar-item" href="/curriculum">Curriculum</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/article">Articles</a><a class="navbar-item" href="/project">Projects</a><a class="navbar-item" href="/publication">Publications</a><a class="navbar-item" href="/reading">Readings</a><a class="navbar-item" href="/life">Life</a><a class="navbar-item" href="/essay">Essay</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/faq">FAQs</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Switch Color Scheme" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitter" href="https://gitter.im/leimao/community"><i class="fab fa-gitter"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-content"><center><div class="bsa-standard" id="carbon-ad-01"></div><script>            (function() {             if (typeof _bsa !== 'undefined' && _bsa) {                 _bsa.init('custom', 'CWYD65QY', 'placement:leimaogithubio-standard', {                     target: '#carbon-ad-01',                     template: `             <a href='##link##' class='native-banner' style='background: ##backgroundColor##' rel='sponsored noopener' target='_blank' title='##company## — ##tagline##'>                 <img class='native-img' width='125' src='##logo##' />                 <div class='native-main'>                     <div class='native-details' style='                             color: ##textColor##;                             border-left: solid 1px ##textColor##;                         '>                         <span class='native-company'>Sponsored by ##company##</span>                         <span class='native-desc'>##description##</span>                     </div>                     <span class='native-cta' style='                             color: ##ctaTextColor##;                             background-color: ##ctaBackgroundColor##;                         '>##callToAction##</span>                 </div>             </a>             `,                 });                 }             })();         </script></center></div></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3" style="font-family: 'PT Sans Narrow', sans-serif">C++ Pointer Adjustment</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left" style="margin-bottom: 0.50rem"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2023-06-26T07:00:00.000Z" title="2023-06-26T07:00:00.000Z">06-26-2023</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2023-06-26T07:00:00.000Z" title="2023-06-26T07:00:00.000Z">06-26-2023</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/blog/">blog</a></span><span class="level-item"><i class="far fa-clock"></i> 12 minutes read (About 1821 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;visits</span></div></div><div class="content" style="margin-top: 1.0rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>C++ runtime polymorphisms can be achieved using a base class pointer pointing to the derived class object and the overridden functions implemented in the derived class object can be found and called via the base class vtable pointer. C++ pointer adjustment at runtime ensures that the base class vtable pointer is always found correctly.</p>
<p>In this blog post, I would like to quickly discuss C++ pointer adjustment using an example and compiler analysis tools.</p>
<h2 id="C-Pointer-Adjustment"><a href="#C-Pointer-Adjustment" class="headerlink" title="C++ Pointer Adjustment"></a>C++ Pointer Adjustment</h2><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>This is a quick example that shows the C++ runtime polymorphisms and how the (base) pointer addresses got adjusted during runtime.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base1</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Base1::foo() is called.&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="type">double</span> m_v1;</span><br><span class="line">    <span class="type">char</span> m_v2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base2</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Base2::bar() is called.&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="type">int</span> m_v1;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base1, <span class="keyword">public</span> Base2</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::foo() is called.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Derived::bar() is called.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> m_v1;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Derived derived&#123;&#125;;</span><br><span class="line">    Derived* derived_ptr = &amp;derived;</span><br><span class="line"></span><br><span class="line">    Base1* base1_ptr = derived_ptr;</span><br><span class="line">    <span class="comment">// Derived::foo() is called.</span></span><br><span class="line">    base1_ptr-&gt;<span class="built_in">foo</span>();</span><br><span class="line"></span><br><span class="line">    Base2* base2_ptr = derived_ptr;</span><br><span class="line">    <span class="comment">// Derived::bar() is called.</span></span><br><span class="line">    base2_ptr-&gt;<span class="built_in">bar</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base1 Ptr Address: &quot;</span> &lt;&lt; base1_ptr &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base2 Ptr Address: &quot;</span> &lt;&lt; base2_ptr &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Derived Ptr Address: &quot;</span> &lt;&lt; derived_ptr &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// This will not work and should not be used.</span></span><br><span class="line">    <span class="comment">// std::cout &lt;&lt; static_cast&lt;Base2*&gt;(base1Ptr) &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">// In practice, need to check if dynamic cast is successful at runtime.</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base2 Ptr Dynamically Casted from Base1 Ptr Address: &quot;</span></span><br><span class="line">              &lt;&lt; <span class="built_in">dynamic_cast</span>&lt;Base2*&gt;(base1_ptr) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base1 Ptr Dynamically Casted from Base2 Ptr Address: &quot;</span></span><br><span class="line">              &lt;&lt; <span class="built_in">dynamic_cast</span>&lt;Base1*&gt;(base2_ptr) &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// C-casts are dangerous and incorrect in these use cases.</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base2 Ptr C-Casted from Base1 Ptr Address: &quot;</span></span><br><span class="line">              &lt;&lt; (Base2*)(base1_ptr) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Base1 Ptr C-Casted from Base2 Ptr Address: &quot;</span></span><br><span class="line">              &lt;&lt; (Base1*)(base2_ptr) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Build-and-Run-Example"><a href="#Build-and-Run-Example" class="headerlink" title="Build and Run Example"></a>Build and Run Example</h3><p>We will build the example with debugging mode for later analysis. Running the example shows that the pointer addresses did get adjusted if correct implementations are used.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -g pointer_adjustment.cpp -o pointer_adjustment</span><br><span class="line">$ ./pointer_adjustment</span><br><span class="line">Derived::foo() is called.</span><br><span class="line">Derived::bar() is called.</span><br><span class="line">Base1 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr Address: 0x7ffd5d192958</span><br><span class="line">Derived Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr Dynamically Casted from Base1 Ptr Address: 0x7ffd5d192958</span><br><span class="line">Base1 Ptr Dynamically Casted from Base2 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr C-Casted from Base1 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base1 Ptr C-Casted from Base2 Ptr Address: 0x7ffd5d192958</span><br></pre></td></tr></table></figure>

<h3 id="Analyze-Example"><a href="#Analyze-Example" class="headerlink" title="Analyze Example"></a>Analyze Example</h3><p>We will analyze the example built with debugging mode using <code>pahole</code>. It can be installed simply via <code>sudo apt install pahole</code> on Linux. The <code>pahole</code> analysis result is as follows.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">$ pahole pointer_adjustment</span><br><span class="line">die__process_class: tag not supported 0x2f (template_type_parameter)!</span><br><span class="line">struct typedef __va_list_tag __va_list_tag &#123;</span><br><span class="line">        unsigned int               gp_offset;            /*     0     4 */</span><br><span class="line">        unsigned int               fp_offset;            /*     4     4 */</span><br><span class="line">        void *                     overflow_arg_area;    /*     8     8 */</span><br><span class="line">        void *                     reg_save_area;        /*    16     8 */</span><br><span class="line"></span><br><span class="line">        /* size: 24, cachelines: 1, members: 4 */</span><br><span class="line">        /* last cacheline: 24 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">struct _IO_FILE &#123;</span><br><span class="line">        int                        _flags;               /*     0     4 */</span><br><span class="line"></span><br><span class="line">        /* XXX 4 bytes hole, try to pack */</span><br><span class="line"></span><br><span class="line">        char *                     _IO_read_ptr;         /*     8     8 */</span><br><span class="line">        char *                     _IO_read_end;         /*    16     8 */</span><br><span class="line">        char *                     _IO_read_base;        /*    24     8 */</span><br><span class="line">        char *                     _IO_write_base;       /*    32     8 */</span><br><span class="line">        char *                     _IO_write_ptr;        /*    40     8 */</span><br><span class="line">        char *                     _IO_write_end;        /*    48     8 */</span><br><span class="line">        char *                     _IO_buf_base;         /*    56     8 */</span><br><span class="line">        /* --- cacheline 1 boundary (64 bytes) --- */</span><br><span class="line">        char *                     _IO_buf_end;          /*    64     8 */</span><br><span class="line">        char *                     _IO_save_base;        /*    72     8 */</span><br><span class="line">        char *                     _IO_backup_base;      /*    80     8 */</span><br><span class="line">        char *                     _IO_save_end;         /*    88     8 */</span><br><span class="line">        struct _IO_marker *        _markers;             /*    96     8 */</span><br><span class="line">        struct _IO_FILE *          _chain;               /*   104     8 */</span><br><span class="line">        int                        _fileno;              /*   112     4 */</span><br><span class="line">        int                        _flags2;              /*   116     4 */</span><br><span class="line">        __off_t                    _old_offset;          /*   120     8 */</span><br><span class="line">        /* --- cacheline 2 boundary (128 bytes) --- */</span><br><span class="line">        short unsigned int         _cur_column;          /*   128     2 */</span><br><span class="line">        signed char                _vtable_offset;       /*   130     1 */</span><br><span class="line">        char                       _shortbuf[1];         /*   131     1 */</span><br><span class="line"></span><br><span class="line">        /* XXX 4 bytes hole, try to pack */</span><br><span class="line"></span><br><span class="line">        _IO_lock_t *               _lock;                /*   136     8 */</span><br><span class="line">        __off64_t                  _offset;              /*   144     8 */</span><br><span class="line">        struct _IO_codecvt *       _codecvt;             /*   152     8 */</span><br><span class="line">        struct _IO_wide_data *     _wide_data;           /*   160     8 */</span><br><span class="line">        struct _IO_FILE *          _freeres_list;        /*   168     8 */</span><br><span class="line">        void *                     _freeres_buf;         /*   176     8 */</span><br><span class="line">        size_t                     __pad5;               /*   184     8 */</span><br><span class="line">        /* --- cacheline 3 boundary (192 bytes) --- */</span><br><span class="line">        int                        _mode;                /*   192     4 */</span><br><span class="line">        char                       _unused2[20];         /*   196    20 */</span><br><span class="line"></span><br><span class="line">        /* size: 216, cachelines: 4, members: 29 */</span><br><span class="line">        /* <span class="built_in">sum</span> members: 208, holes: 2, <span class="built_in">sum</span> holes: 8 */</span><br><span class="line">        /* last cacheline: 24 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">struct tm &#123;</span><br><span class="line">        int                        tm_sec;               /*     0     4 */</span><br><span class="line">        int                        tm_min;               /*     4     4 */</span><br><span class="line">        int                        tm_hour;              /*     8     4 */</span><br><span class="line">        int                        tm_mday;              /*    12     4 */</span><br><span class="line">        int                        tm_mon;               /*    16     4 */</span><br><span class="line">        int                        tm_year;              /*    20     4 */</span><br><span class="line">        int                        tm_wday;              /*    24     4 */</span><br><span class="line">        int                        tm_yday;              /*    28     4 */</span><br><span class="line">        int                        tm_isdst;             /*    32     4 */</span><br><span class="line"></span><br><span class="line">        /* XXX 4 bytes hole, try to pack */</span><br><span class="line"></span><br><span class="line">        long int                   tm_gmtoff;            /*    40     8 */</span><br><span class="line">        const char  *              tm_zone;              /*    48     8 */</span><br><span class="line"></span><br><span class="line">        /* size: 56, cachelines: 1, members: 11 */</span><br><span class="line">        /* <span class="built_in">sum</span> members: 52, holes: 1, <span class="built_in">sum</span> holes: 4 */</span><br><span class="line">        /* last cacheline: 56 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">struct lconv &#123;</span><br><span class="line">        char *                     decimal_point;        /*     0     8 */</span><br><span class="line">        char *                     thousands_sep;        /*     8     8 */</span><br><span class="line">        char *                     grouping;             /*    16     8 */</span><br><span class="line">        char *                     int_curr_symbol;      /*    24     8 */</span><br><span class="line">        char *                     currency_symbol;      /*    32     8 */</span><br><span class="line">        char *                     mon_decimal_point;    /*    40     8 */</span><br><span class="line">        char *                     mon_thousands_sep;    /*    48     8 */</span><br><span class="line">        char *                     mon_grouping;         /*    56     8 */</span><br><span class="line">        /* --- cacheline 1 boundary (64 bytes) --- */</span><br><span class="line">        char *                     positive_sign;        /*    64     8 */</span><br><span class="line">        char *                     negative_sign;        /*    72     8 */</span><br><span class="line">        char                       int_frac_digits;      /*    80     1 */</span><br><span class="line">        char                       frac_digits;          /*    81     1 */</span><br><span class="line">        char                       p_cs_precedes;        /*    82     1 */</span><br><span class="line">        char                       p_sep_by_space;       /*    83     1 */</span><br><span class="line">        char                       n_cs_precedes;        /*    84     1 */</span><br><span class="line">        char                       n_sep_by_space;       /*    85     1 */</span><br><span class="line">        char                       p_sign_posn;          /*    86     1 */</span><br><span class="line">        char                       n_sign_posn;          /*    87     1 */</span><br><span class="line">        char                       int_p_cs_precedes;    /*    88     1 */</span><br><span class="line">        char                       int_p_sep_by_space;   /*    89     1 */</span><br><span class="line">        char                       int_n_cs_precedes;    /*    90     1 */</span><br><span class="line">        char                       int_n_sep_by_space;   /*    91     1 */</span><br><span class="line">        char                       int_p_sign_posn;      /*    92     1 */</span><br><span class="line">        char                       int_n_sign_posn;      /*    93     1 */</span><br><span class="line"></span><br><span class="line">        /* size: 96, cachelines: 2, members: 24 */</span><br><span class="line">        /* padding: 2 */</span><br><span class="line">        /* last cacheline: 32 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">struct _G_fpos_t &#123;</span><br><span class="line">        __off_t                    __pos;                /*     0     8 */</span><br><span class="line">        __mbstate_t                __state;              /*     8     8 */</span><br><span class="line"></span><br><span class="line">        /* size: 16, cachelines: 1, members: 2 */</span><br><span class="line">        /* last cacheline: 16 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Derived : public Base1, public Base2 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Base1               &lt;ancestor&gt;; */      /*     0    24 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 7 bytes of padding */</span><br><span class="line"></span><br><span class="line">        /* class Base2               &lt;ancestor&gt;; */      /*    24    16 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 4 bytes of padding */</span><br><span class="line">        /* XXX 65532 bytes hole, try to pack */</span><br><span class="line">        void ~Derived(class Derived *, int);</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *, );</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *, const class Derived  &amp;);</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Derived *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Derived *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        int                        m_v1;                 /*    36     4 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [0] = foo((null)), </span><br><span class="line">           [1] = bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 40, cachelines: 1, members: 3 */</span><br><span class="line">        /* <span class="built_in">sum</span> members: 4, holes: 1, <span class="built_in">sum</span> holes: 65532 */</span><br><span class="line">        /* paddings: 2, <span class="built_in">sum</span> paddings: 11 */</span><br><span class="line">        /* last cacheline: 40 bytes */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 40 bytes != 4 (member bytes) + 0 (member bits) + 65532 (byte holes) + 0 (bit holes), diff = -523968 bits */</span><br><span class="line">&#125;;</span><br><span class="line">class Base1 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void ~Base1(class Base1 *, int);</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *, );</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *, const class Base1  &amp;);</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Base1;          /*     0     8 */</span><br><span class="line">        virtual void foo(class Base1 *);</span><br><span class="line"></span><br><span class="line">        double                     m_v1;                 /*     8     8 */</span><br><span class="line">        char                       m_v2;                 /*    16     1 */</span><br><span class="line">        /* vtable has 1 entries: &#123;</span><br><span class="line">           [0] = foo((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 24, cachelines: 1, members: 3 */</span><br><span class="line">        /* padding: 7 */</span><br><span class="line">        /* last cacheline: 24 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Base2 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void ~Base2(class Base2 *, int);</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *, );</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *, const class Base2  &amp;);</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Base2;          /*     0     8 */</span><br><span class="line">        virtual void bar(class Base2 *);</span><br><span class="line"></span><br><span class="line">        int                        m_v1;                 /*     8     4 */</span><br><span class="line">        /* vtable has 1 entries: &#123;</span><br><span class="line">           [0] = bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 16, cachelines: 1, members: 2 */</span><br><span class="line">        /* padding: 4 */</span><br><span class="line">        /* last cacheline: 16 bytes */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>On the stack, the first element of a <code>Base1</code> object is the vtable pointer <code>_vptr.Base1</code> and it takes 8 bytes. The base size of a <code>Base1</code> object is <code>sizeof(Base1::_vptr.Base1) + sizeof(Base1::m_v1) + sizeof(Base1::m_v2) = 8 + 8 + 1 = 17</code> bytes, and it is padded to 24 bytes because of the 8 byte alignment requirement for the class.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Base1 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void ~Base1(class Base1 *, int);</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *, );</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *, const class Base1  &amp;);</span><br><span class="line"></span><br><span class="line">        void Base1(class Base1 *);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Base1;          /*     0     8 */</span><br><span class="line">        virtual void foo(class Base1 *);</span><br><span class="line"></span><br><span class="line">        double                     m_v1;                 /*     8     8 */</span><br><span class="line">        char                       m_v2;                 /*    16     1 */</span><br><span class="line">        /* vtable has 1 entries: &#123;</span><br><span class="line">           [0] = foo((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 24, cachelines: 1, members: 3 */</span><br><span class="line">        /* padding: 7 */</span><br><span class="line">        /* last cacheline: 24 bytes */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>Similarly, the first element of a <code>Base2</code> object is the vtable pointer <code>_vptr.Base2</code> and it takes 8 bytes. The base size of a <code>Base2</code> object is <code>sizeof(Base1::_vptr.Base2) + sizeof(Base1::m_v1) = 8 + 4 = 12</code> bytes, and it is padded to 16 bytes because of the 8 byte alignment requirement for the class.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class Base2 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void ~Base2(class Base2 *, int);</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *, );</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *, const class Base2  &amp;);</span><br><span class="line"></span><br><span class="line">        void Base2(class Base2 *);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Base2;          /*     0     8 */</span><br><span class="line">        virtual void bar(class Base2 *);</span><br><span class="line"></span><br><span class="line">        int                        m_v1;                 /*     8     4 */</span><br><span class="line">        /* vtable has 1 entries: &#123;</span><br><span class="line">           [0] = bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 16, cachelines: 1, members: 2 */</span><br><span class="line">        /* padding: 4 */</span><br><span class="line">        /* last cacheline: 16 bytes */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>The memory layout of a <code>Derived</code> object on the stack is the stack content of a <code>Base1</code> object which takes 24 bytes followed by a <code>Base2</code> object which takes 16 bytes followed by the <code>Derived</code> member objects. The base size of a <code>Derived</code> object is supposed to be <code>sizeof(Base1) + sizeof(Base2) + sizeof(Derived::m_v1) = 24 + 16 + 4 = 44</code> bytes and it will be further padded to 48 bytes because of the alignment requirement. However, we could see that the actual size of a <code>Derived</code> object is just 40 bytes. This is actually due to a compiler optimization. Because a <code>Base2</code> object will add 4 bytes for padding, and it happens to fit the <code>Derived::m_v1</code> which is of <code>int</code> type, thus <code>Derived::m_v1</code> is placed to the place where originally the padded bytes are for a <code>Base2</code> object. The <code>pahole</code> analysis result also tells us that the offset of <code>Derived::m_v1</code> is 36 instead of 40.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class Derived : public Base1, public Base2 &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Base1               &lt;ancestor&gt;; */      /*     0    24 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 7 bytes of padding */</span><br><span class="line"></span><br><span class="line">        /* class Base2               &lt;ancestor&gt;; */      /*    24    16 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 4 bytes of padding */</span><br><span class="line">        /* XXX 65532 bytes hole, try to pack */</span><br><span class="line">        void ~Derived(class Derived *, int);</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *, );</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *, const class Derived  &amp;);</span><br><span class="line"></span><br><span class="line">        void Derived(class Derived *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Derived *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Derived *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        int                        m_v1;                 /*    36     4 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [0] = foo((null)), </span><br><span class="line">           [1] = bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 40, cachelines: 1, members: 3 */</span><br><span class="line">        /* sum members: 4, holes: 1, sum holes: 65532 */</span><br><span class="line">        /* paddings: 2, sum paddings: 11 */</span><br><span class="line">        /* last cacheline: 40 bytes */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 40 bytes != 4 (member bytes) + 0 (member bits) + 65532 (byte holes) + 0 (bit holes), diff = -523968 bits */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Anyhow, we would expect that a <code>Base1</code> pointer to the <code>Derived</code> object will be the same as a <code>Derived</code> pointer to the <code>Derived</code> object, a <code>Base2</code> pointer to the <code>Derived</code> object will be 24 bytes larger than a <code>Base1</code> pointer to the <code>Derived</code> object. In fact, our program print out has verified this. Notice that hexadecimal subtraction <code>0x7ffd5d192958 - 0x7ffd5d192940</code> results in 24 decimal.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -g pointer_adjustment.cpp -o pointer_adjustment</span><br><span class="line">$ ./pointer_adjustment</span><br><span class="line">Derived::foo() is called.</span><br><span class="line">Derived::bar() is called.</span><br><span class="line">Base1 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr Address: 0x7ffd5d192958</span><br><span class="line">Derived Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr Dynamically Casted from Base1 Ptr Address: 0x7ffd5d192958</span><br><span class="line">Base1 Ptr Dynamically Casted from Base2 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base2 Ptr C-Casted from Base1 Ptr Address: 0x7ffd5d192940</span><br><span class="line">Base1 Ptr C-Casted from Base2 Ptr Address: 0x7ffd5d192958</span><br></pre></td></tr></table></figure>

<p>In our case, the two vtables from the two base classes are distinct. The <code>Derived::foo()</code> is not in the <code>Base2</code> vtable and the <code>Derived::bar()</code> is not in the <code>Base1</code> vtable because the base classes did not declare them respectively.  When the overridden functions are called via a <code>Base1</code> pointer to the <code>Derived</code> object, the <code>Base1::_vptr.Base1</code> vtable pointer will be used for finding the overridden function pointers, when the overridden functions are called via a <code>Base2</code> pointer to the <code>Derived</code> object, the <code>Base2::_vptr.Base1</code> vtable will be used for finding the overridden function pointers.</p>
<p>Without pointer adjustment, say, a <code>Base1</code> pointer and a <code>Base2</code> pointer both points to the beginning of the <code>Derived</code> object and the <code>Base1::_vptr.Base1</code> vtable pointer will be used for finding the overridden functions, the <code>Base2</code> pointer overridden function call will not work as expected and result in undefined behaviors.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>The pointer adjustment ensures that base pointers can correctly point to the member objects it owns, including the vtable pointer. This is critical for ensuring the runtime polymorphic behaviors via the correct vtable pointers are always expected.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>C++ Pointer Adjustment</p><p><a href="https://levanliu.github.io/blog/CPP-Pointer-Adjustment/">https://levanliu.github.io/blog/CPP-Pointer-Adjustment/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Lei Mao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>06-26-2023</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>06-26-2023</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <div><a class="link-muted" rel="tag" href="/tags/Programming/">Programming,</a> </div><div><a class="link-muted" rel="tag" href="/tags/C/">C++ </a> </div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61b5930d440224001908310c&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered has-text-weight-normal">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="SSVSLEH4X85LU"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" href="https://www.buymeacoffee.com/leimao" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/life/McClellan-Ranch-Preserve/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">McClellan Ranch Preserve 徒步</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/essay/%E5%9B%9E%E5%BF%862011%E5%B9%B4%E8%8B%B1%E5%9B%BD%E4%B9%8B%E8%A1%8C/"><span class="level-item">回忆 2011 年英国之行</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comment-card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="comment-block"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://levanliu.github.io/blog/CPP-Pointer-Adjustment/';
            this.page.identifier = '/blog/CPP-Pointer-Adjustment/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'leimao-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/author_images/Lei-Bio-Medium.jpg" alt="Lei Mao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.30rem;">Lei Mao</p><p class="is-block" style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 0.8em">Artificial Intelligence
Machine Learning
Computer Science
</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Santa Clara, California</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">453</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/leimao" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a> <a class="level-item button is-primary is-rounded" href="https://github.com/sponsors/leimao" target="_blank" rel="noopener"><i class="fas fa-heart"></i>  Sponsor</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/matchaleimao"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/lei-mao/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:dukeleimao@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="G.Scholar" href="https://scholar.google.com/citations?user=R2VUf7YAAAAJ"><i class="ai ai-google-scholar-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#C-Pointer-Adjustment"><span class="level-left"><span class="level-item">2</span><span class="level-item">C++ Pointer Adjustment</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Example"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Example</span></span></a></li><li><a class="level is-mobile" href="#Build-and-Run-Example"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Build and Run Example</span></span></a></li><li><a class="level is-mobile" href="#Analyze-Example"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Analyze Example</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Conclusion"><span class="level-left"><span class="level-item">3</span><span class="level-item">Conclusion</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="g-ads-x"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3></div><br><center><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDCK3L&amp;placement=leimaogithubio" id="_carbonads_js"></script></center></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2017-2024 Lei Mao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span> <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>