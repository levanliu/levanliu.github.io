<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>C++ Virtual Table - Lei Mao&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Lei Mao&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lei Mao&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/images/favicon/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="512x512" href="/images/favicon/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="apple-touch-icon" sizes="32x32" href="/images/favicon/favicon-32x32.png"><meta name="description" content="C++ VTable for Runtime Polymorphisms"><meta property="og:type" content="blog"><meta property="og:title" content="C++ Virtual Table"><meta property="og:url" content="https://leimao.github.io/blog/CPP-Virtual-Table/"><meta property="og:site_name" content="Lei Mao&#039;s Log Book"><meta property="og:description" content="C++ VTable for Runtime Polymorphisms"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="article:published_time" content="2023-07-17T07:00:00.000Z"><meta property="article:modified_time" content="2023-07-17T07:00:00.000Z"><meta property="article:author" content="Lei Mao"><meta property="article:tag" content="CPP"><meta property="article:tag" content="Programming"><meta property="article:tag" content="CPP Compiler"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="twitter:creator" content="@matchaleimao"><meta property="twitter:site" content="Lei Mao&#039;s Log Book"><meta property="fb:admins" content="dukeleimao"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://leimao.github.io/blog/CPP-Virtual-Table/"},"headline":"C++ Virtual Table","image":["https://leimao.github.io/images/favicon/android-chrome-512x512.png"],"datePublished":"2023-07-17T07:00:00.000Z","dateModified":"2023-07-17T07:00:00.000Z","author":{"@type":"Person","name":"Lei Mao"},"publisher":{"@type":"Organization","name":"Lei Mao's Log Book","logo":{"@type":"ImageObject","url":"https://leimao.github.io/images/favicon/android-chrome-512x512.png"}},"description":"C++ VTable for Runtime Polymorphisms"}</script><link rel="canonical" href="https://leimao.github.io/blog/CPP-Virtual-Table/"><link rel="alternate" href="/atom.xml" title="Lei Mao&#039;s Log Book" type="application/atom+xml"><link rel="icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=PT+Sans+Narrow:wght@400;700&amp;family=PT+Serif"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-EJY6FXZBCB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-EJY6FXZBCB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script src="//m.servedby-buysellads.com/monetization.custom.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Lei Mao&#039;s Log Book</a><a class="navbar-item" href="/curriculum">Curriculum</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/article">Articles</a><a class="navbar-item" href="/project">Projects</a><a class="navbar-item" href="/publication">Publications</a><a class="navbar-item" href="/reading">Readings</a><a class="navbar-item" href="/life">Life</a><a class="navbar-item" href="/essay">Essay</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/faq">FAQs</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Switch Color Scheme" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitter" href="https://gitter.im/leimao/community"><i class="fab fa-gitter"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-content"><center><div class="bsa-standard" id="carbon-ad-01"></div><script>            (function() {             if (typeof _bsa !== 'undefined' && _bsa) {                 _bsa.init('custom', 'CWYD65QY', 'placement:leimaogithubio-standard', {                     target: '#carbon-ad-01',                     template: `             <a href='##link##' class='native-banner' style='background: ##backgroundColor##' rel='sponsored noopener' target='_blank' title='##company## — ##tagline##'>                 <img class='native-img' width='125' src='##logo##' />                 <div class='native-main'>                     <div class='native-details' style='                             color: ##textColor##;                             border-left: solid 1px ##textColor##;                         '>                         <span class='native-company'>Sponsored by ##company##</span>                         <span class='native-desc'>##description##</span>                     </div>                     <span class='native-cta' style='                             color: ##ctaTextColor##;                             background-color: ##ctaBackgroundColor##;                         '>##callToAction##</span>                 </div>             </a>             `,                 });                 }             })();         </script></center></div></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3" style="font-family: 'PT Sans Narrow', sans-serif">C++ Virtual Table</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left" style="margin-bottom: 0.50rem"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2023-07-17T07:00:00.000Z" title="2023-07-17T07:00:00.000Z">07-17-2023</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2023-07-17T07:00:00.000Z" title="2023-07-17T07:00:00.000Z">07-17-2023</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/blog/">blog</a></span><span class="level-item"><i class="far fa-clock"></i> an hour read (About 7690 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;visits</span></div></div><div class="content" style="margin-top: 1.0rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>The C++ virtual table is the fundamental building block for <a href="/blog/CPP-Polymorphisms/#Runtime-Polymorphism">C++ runtime polymorphisms</a>. A virtual table (vtable) is a table of information used to dispatch virtual functions, to access virtual base class subobjects, and to access information for runtime type identification (RTTI). </p>
<p>In this blog post, I would like to discuss the C++ virtual table in detail and show a couple of concrete examples.</p>
<!-- 

Each class that has virtual member functions or virtual bases has an associated set of virtual tables. There may be multiple virtual tables for a particular class, if it is used as a base class for other classes. However, the virtual table pointers within all the objects (instances) of a particular most-derived class point to the same set of virtual tables.


 -->




<h2 id="Non-Virtual-Inheritance"><a href="#Non-Virtual-Inheritance" class="headerlink" title="Non-Virtual Inheritance"></a>Non-Virtual Inheritance</h2><p>Non-virtual inheritance is the most straightforward inheritance that we commonly use in C++. If the inheritance access specifiers, including <code>private</code>, <code>public</code>, and <code>protected</code>, do not have the keyword <code>virtual</code>, then it’s the non-virtual inheritance. The class that another class inherits is called the base class, and the other class is called the derived class.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>The following example created four classes <code>Fruit</code>, <code>Drug</code>, <code>Apple</code>, and <code>Orange</code>. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fruit</span><br><span class="line">  |</span><br><span class="line">Apple</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fruit   Drug</span><br><span class="line">  \      /</span><br><span class="line">   Orange</span><br></pre></td></tr></table></figure>

<p>The <code>Apple</code> class inherits from the <code>Fruit</code> class. The <code>Orange</code> class inherits from multiple classes, including the <code>Fruit</code> class and the <code>Drug</code> class.</p>
<figure class="highlight c++"><figcaption><span>inheritance.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Drug</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Drug</span>(<span class="type">int</span> property) : m_property&#123;property&#125; &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Drug</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">baz</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> m_property;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fruit</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Fruit</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country)</span><br><span class="line">        : m_size&#123;size&#125;, m_id&#123;id&#125;, m_country&#123;country&#125; &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Fruit</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bar</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="type">double</span> m_size;</span><br><span class="line">    <span class="type">int</span> m_id;</span><br><span class="line">    <span class="type">char</span> m_country;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apple</span> : <span class="keyword">public</span> Fruit</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Apple</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country, <span class="type">int</span> color)</span><br><span class="line">        : Fruit&#123;size, id, country&#125;, m_color&#123;color&#125; &#123;&#125;;</span><br><span class="line">    ~<span class="built_in">Apple</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_color</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">apple_foo</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="type">int</span> m_color;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Orange</span> : <span class="keyword">public</span> Fruit, <span class="keyword">public</span> Drug</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Orange</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country, <span class="type">double</span> weight)</span><br><span class="line">        : Fruit&#123;size, id, country&#125;, Drug&#123;<span class="number">4</span>&#125;, m_weight&#123;weight&#125; &#123;&#125;;</span><br><span class="line">    ~<span class="built_in">Orange</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="comment">// Overriding Fruit virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Overriding Drug virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">baz</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Orange non-virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_weight</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Orange virtual functions.</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">orange_bar</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="type">double</span> m_weight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> apple_size&#123;<span class="number">1.0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> apple_id&#123;<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="type">char</span> <span class="type">const</span> apple_country&#123;<span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> apple_color&#123;<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> orange_size&#123;<span class="number">0.8</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> orange_id&#123;<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="type">char</span> <span class="type">const</span> orange_country&#123;<span class="string">&#x27;n&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> orange_weight&#123;<span class="number">0.6</span>&#125;;</span><br><span class="line">    Apple apple&#123;apple_size, apple_id, apple_country, apple_color&#125;;</span><br><span class="line">    Orange orange&#123;orange_size, orange_id, orange_country, orange_weight&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Class-Hierarchy-and-Virtual-Table"><a href="#Class-Hierarchy-and-Virtual-Table" class="headerlink" title="Class Hierarchy and Virtual Table"></a>Class Hierarchy and Virtual Table</h3><p>We could dump class hierarchy information, including the virtual table information, using <code>-fdump-lang-class</code> for the GCC compiler. The field <code>Vtable</code>, i.e., virtual table, is the most critical component for C++ runtime polymorphisms. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The hierarchy and virtual table information was saved in the file</span></span><br><span class="line"><span class="comment"># inheritance.cpp.001l.class.</span></span><br><span class="line">$ g++ -g -fdump-lang-class inheritance.cpp -o inheritance</span><br><span class="line">$ <span class="built_in">cat</span> inheritance.cpp.001l.class </span><br><span class="line">Vtable <span class="keyword">for</span> Drug</span><br><span class="line">Drug::_ZTV4Drug: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">16    0</span><br><span class="line">24    0</span><br><span class="line">32    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line"></span><br><span class="line">Class Drug</span><br><span class="line">   size=16 align=8</span><br><span class="line">   base size=12 base align=8</span><br><span class="line">Drug (0x0x7f79a8d6d420) 0</span><br><span class="line">    vptr=((&amp; Drug::_ZTV4Drug) + <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Fruit</span><br><span class="line">Fruit::_ZTV5Fruit: <span class="number">6</span> entries</span><br><span class="line"><span class="number">0</span>     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">16    0</span><br><span class="line">24    0</span><br><span class="line">32    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br><span class="line"></span><br><span class="line">Class Fruit</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=21 base align=8</span><br><span class="line">Fruit (0x0x7f79a8d6d6c0) 0</span><br><span class="line">    vptr=((&amp; Fruit::_ZTV5Fruit) + <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Apple</span><br><span class="line">Apple::_ZTV5Apple: <span class="number">7</span> entries</span><br><span class="line"><span class="number">0</span>     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">16    (int (*)(...))Apple::~Apple</span><br><span class="line">24    (int (*)(...))Apple::~Apple</span><br><span class="line">32    (int (*)(...))Apple::foo</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br><span class="line">48    (int (*)(...))Apple::apple_foo</span><br><span class="line"></span><br><span class="line">Class Apple</span><br><span class="line">   size=32 align=8</span><br><span class="line">   base size=28 base align=8</span><br><span class="line">Apple (0x0x7f79a8c0e340) 0</span><br><span class="line">    vptr=((&amp; Apple::_ZTV5Apple) + <span class="number">16</span>)</span><br><span class="line">Fruit (<span class="number">0</span>x0x7f79a8d6d900) <span class="number">0</span></span><br><span class="line">      primary-for Apple (<span class="number">0</span>x0x7f79a8c0e340)</span><br><span class="line"></span><br><span class="line">Vtable for Orange</span><br><span class="line">Orange::_ZTV6Orange: <span class="number">14</span> entries</span><br><span class="line"><span class="number">0</span>     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">16    (int (*)(...))Orange::~Orange</span><br><span class="line">24    (int (*)(...))Orange::~Orange</span><br><span class="line">32    (int (*)(...))Orange::foo</span><br><span class="line">40    (int (*)(...))Orange::bar</span><br><span class="line">48    (int (*)(...))Orange::baz</span><br><span class="line">56    (int (*)(...))Orange::orange_bar</span><br><span class="line">64    (int (*)(...))-24</span><br><span class="line">72    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">80    (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</span><br><span class="line">88    (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</span><br><span class="line">96    (int (*)(...))Orange::_ZThn24_N6Orange3fooEv</span><br><span class="line">104   (int (*)(...))Orange::_ZThn24_N6Orange3bazEv</span><br><span class="line"></span><br><span class="line">Class Orange</span><br><span class="line">   size=48 align=8</span><br><span class="line">   base size=48 base align=8</span><br><span class="line">Orange (0x0x7f79a8d81770) 0</span><br><span class="line">    vptr=((&amp; Orange::_ZTV6Orange) + <span class="number">16</span>)</span><br><span class="line">Fruit (<span class="number">0</span>x0x7f79a8d6de40) <span class="number">0</span></span><br><span class="line">      primary-for Orange (<span class="number">0</span>x0x7f79a8d81770)</span><br><span class="line">Drug (<span class="number">0</span>x0x7f79a8d6dea0) <span class="number">24</span></span><br><span class="line">      vptr=((&amp; Orange::_ZTV6Orange) + <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>We will go through the class hierarchy information, including the virtual table information, for each class in detail.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Drug</span><br><span class="line">Drug::_ZTV4Drug: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">16    0</span><br><span class="line">24    0</span><br><span class="line">32    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br></pre></td></tr></table></figure>

<p><code>Drug::_ZTV4Drug: 6 entries</code> says the name of the vtable, which is a static array, is <code>Drug::_ZTV4Drug</code> and there are 6 function pointer entries in the static array. The offset of each entry is <code>8</code> bytes.</p>
<ul>
<li><code>0     (int (*)(...))0</code> is the offset-to-top value for the <code>Drug</code> class pointer adjustment. This is particularly used for dynamically switching the vtable pointers between different base classes and derived classes using <code>dynamic_cast</code>. In this case, because <code>Drug</code> is just the base class and there is no need for pointer adjustment for <code>Drug</code> objects, so the offset-to-top value is 0. As we will see later, the offset-to-top value in the vtable for the <code>Drug</code> subobject in the classes derived from <code>Drug</code> might not be 0.</li>
<li><code>8     (int (*)(...))(&amp; _ZTI4Drug)</code> is the typeinfo pointer to the type information of the <code>Drug</code> class. This allows the user to know at runtime what exactly the object type is, even if the user just receives a base class pointer to a polymorphic class object. Without this field, given a base class pointer to a polymorphic class object, the user would not know whether base class pointer points to a base class object or derived class object. In this case, the typeinfo pointer points to a buffer where the <code>Drug</code> class description is stored. As we will see later, the typeinfo pointer in the vtable for the <code>Drug</code> subobject in the classes derived from <code>Drug</code> will point to the buffer that stores the derived class description instead of the <code>Drug</code> class description.</li>
<li><code>16    0</code> and <code>24    0</code> are the pairs of entries for for virtual destructors. Why there are two destructors? The first destructor, called the complete object destructor, performs the destruction without calling <code>delete()</code> on the object. The second destructor, called the deleting destructor, calls <code>delete()</code> after destroying the object. Both destroy any virtual bases; a separate, non-virtual function, called the base object destructor, performs destruction of the object but not its virtual base subobjects, and does not call <code>delete()</code>. Sometimes, we would like to only destroy the object without deallocating the memory. That’s why we have two destructors. Because the <code>Drug</code> class is an abstract class due to it has at least one pure virtual function, it cannot be constructed independently. Therefore, there is no need for destructors. That’s why the entries for virtual destructors are null pointers in this case.</li>
<li><code>32    (int (*)(...))__cxa_pure_virtual</code> and <code>40    (int (*)(...))__cxa_pure_virtual</code> are the pointers to the pure virtual functions <code>Drug::foo()</code> and <code>Drug::baz()</code> respectively which will be overridden by the derived class function implementations.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class Drug</span><br><span class="line">   size=16 align=8</span><br><span class="line">   base size=12 base align=8</span><br><span class="line">Drug (0x0x7f79a8d6d420) 0</span><br><span class="line">    vptr=((&amp; Drug::_ZTV4Drug) + 16)</span><br></pre></td></tr></table></figure>

<p>This tells us that a <code>Drug</code> class object base size is 12 bytes, because <code>sizeof(Drug::vtable) + sizeof(Drug::m_property) = 8 + 4 = 12</code>. Because the alignment is <code>8</code> bytes, the actual size of a <code>Drug</code> class object is padded to <code>16</code> bytes. <code>vptr=((&amp; Drug::_ZTV4Drug) + 16)</code> tells us that the virtual functions starts from the address <code>((&amp; Drug::_ZTV4Drug) + 16)</code> which is the <code>16    0</code> reserved for the destructors.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Fruit</span><br><span class="line">Fruit::_ZTV5Fruit: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">16    0</span><br><span class="line">24    0</span><br><span class="line">32    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br><span class="line"></span><br><span class="line">Class Fruit</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=21 base align=8</span><br><span class="line">Fruit (0x0x7f79a8d6d6c0) 0</span><br><span class="line">    vptr=((&amp; Fruit::_ZTV5Fruit) + 16)</span><br></pre></td></tr></table></figure>

<p>Understanding the <code>Fruit</code> class should be almost the same as understanding the <code>Drug</code> class. The small difference is that the <code>Fruit::bar</code> virtual function has already been defined in the base class <code>Fruit</code> and is therefore not a pure virtual function. The base size of the <code>Fruit</code> class object is <code>sizeof(Fruit::vtable) + sizeof(Fruit::m_size) + sizeof(Fruit::m_id) + sizeof(Fruit::m_country) = 8 + 8 + 4 + 1 = 21</code> bytes. Because of the alignment requirement, the size of the <code>Fruit</code> class object is padded to 24 bytes.</p>
<p>Now let’s look at the <code>Apple</code> class which is derived from the <code>Fruit</code> class.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Apple</span><br><span class="line">Apple::_ZTV5Apple: 7 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">16    (int (*)(...))Apple::~Apple</span><br><span class="line">24    (int (*)(...))Apple::~Apple</span><br><span class="line">32    (int (*)(...))Apple::foo</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br><span class="line">48    (int (*)(...))Apple::apple_foo</span><br></pre></td></tr></table></figure>


<p><code>Apple::_ZTV5Apple: 7 entries</code> says the vtable name is <code>Apple::_ZTV5Apple</code> and there are 7 function pointer entries in the vtable. The offset of each entry is <code>8</code> bytes.</p>
<ul>
<li><code>0     (int (*)(...))0</code> is the offset-to-top value for the <code>Fruit</code> and <code>Apple</code> class pointer adjustment. Because the <code>Apple</code> class only has one base class, besides the vtable for the <code>Fruit</code> base class, the vtable for the <code>Apple</code> class is just extended from the vtable for the <code>Fruit</code> base class. Thus the <code>Apple</code> class and the <code>Fruit</code> base class share the same vtable pointer, and there is no need for pointer adjustment.</li>
<li><code>8     (int (*)(...))(&amp; _ZTI5Apple)</code> is the typeinfo pointer to the type information of the <code>Apple</code> class.</li>
<li><code>16    (int (*)(...))Apple::~Apple</code> and <code>24    (int (*)(...))Apple::~Apple</code> are the function pointers to complete object destructor and the deleting destructor. When an <code>Apple</code> class object is constructed, the <code>Fruit</code> base class constructor is first called followed by the <code>Apple</code> class constructor is called. When an <code>Apple</code> class object is destructed, the order of destructor calls must be the reverse of the order of constructor calls. In our case, the <code>Apple</code> destructor is first called followed by the <code>Fruit</code> destructor is called. When an <code>Apple</code> class object is destroyed via an <code>Apple</code> class pointer or a <code>Fruit</code> class base pointer, the deleting destructor of the <code>Apple</code> class, which is different from the complete object destructor, will be called via the vtable. Inside the deleting destructor, after the the <code>Apple</code> class components are removed, the <code>Fruit</code> base class destructor will be called. Finally, the <code>Apple</code> class object is deallocated from the memory.</li>
<li><code>32    (int (*)(...))Apple::foo</code> is the pointer to the overriding functions for <code>Fruit::foo</code>. So even if it is a <code>Fruit</code> base class pointer pointing to an <code>Apple</code> class object, it can always find the overriding function <code>Apple::foo</code> correctly via the vtable.</li>
<li><code>40    (int (*)(...))Fruit::bar</code> is the function pointer to the function <code>Fruit::bar</code> defined in the <code>Fruit</code> base class since it has never been overridden. </li>
<li><code>48    (int (*)(...))Apple::apple_foo</code> is the pointer to the new virtual function <code>Apple::apple_foo</code> for the <code>Apple</code> class. It belongs to the <code>Apple</code> class vtable and is only accessible via an <code>Apple</code> class pointer, even though the <code>Apple</code> class vtable is just extended from the <code>Fruit</code> class vtable on the memory. </li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Class Apple</span><br><span class="line">   size=32 align=8</span><br><span class="line">   base size=28 base align=8</span><br><span class="line">Apple (0x0x7f79a8c0e340) 0</span><br><span class="line">    vptr=((&amp; Apple::_ZTV5Apple) + 16)</span><br><span class="line">Fruit (0x0x7f79a8d6d900) 0</span><br><span class="line">      primary-for Apple (0x0x7f79a8c0e340)</span><br></pre></td></tr></table></figure>

<p>The base size of the <code>Apple</code> class object is <code>sizeof(Fruit) + sizeof(Apple::m_color) = 24 + 4 = 28</code> bytes. Because of the alignment requirement, the size of the <code>Apple</code> class object is padded to 32 bytes. The only vtable pointer <code>vptr</code> for both the <code>Apple</code> and <code>Fruit</code> class points to the first destructor function of <code>Apple</code>, <code>16    (int (*)(...))Apple::~Apple</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Orange</span><br><span class="line">Orange::_ZTV6Orange: 14 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">16    (int (*)(...))Orange::~Orange</span><br><span class="line">24    (int (*)(...))Orange::~Orange</span><br><span class="line">32    (int (*)(...))Orange::foo</span><br><span class="line">40    (int (*)(...))Orange::bar</span><br><span class="line">48    (int (*)(...))Orange::baz</span><br><span class="line">56    (int (*)(...))Orange::orange_bar</span><br><span class="line">64    (int (*)(...))-24</span><br><span class="line">72    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">80    (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</span><br><span class="line">88    (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</span><br><span class="line">96    (int (*)(...))Orange::_ZThn24_N6Orange3fooEv</span><br><span class="line">104   (int (*)(...))Orange::_ZThn24_N6Orange3bazEv</span><br></pre></td></tr></table></figure>

<p><code>Drug::_ZTV6Orange: 14 entries</code> says the vtable name is <code>Drug::_ZTV6Oranges</code> and there are 14 function pointer entries in the vtable. The offset of each entry is <code>8</code> bytes. Because the <code>Orange</code> class is derived from both the <code>Fruit</code> class and the <code>Drug</code> class. This vtable can serve three different class pointers, including the pointers to the <code>Fruit</code>, <code>Drug</code>, and <code>Orange</code> classes.</p>
<ul>
<li><code>0     (int (*)(...))0</code> is the offset-to-top value for the <code>Fruit</code> and <code>Orange</code> class pointer adjustment. For the primary base class <code>Fruit</code> and the <code>Orange</code> class, because their pointers both points to the beginning of the <code>Orange</code> class object, there is no need for pointer adjustment. Therefore, the offset-to-top value for the <code>Fruit</code> and the <code>Orange</code> class is 0.</li>
<li><code>8     (int (*)(...))(&amp; _ZTI6Orange)</code> is the typeinfo pointer to the type information of the <code>Orange</code> class.</li>
<li><code>16    (int (*)(...))Orange::~Orange</code> and <code>24    (int (*)(...))Orange::~Orange</code> are the function pointers to complete object destructor and the deleting destructor. When an <code>Orange</code> class object is constructed, the <code>Fruit</code> base class constructor is first called, followed by the <code>Drug</code> base class constructor is called, followed by the <code>Orange</code> class constructor is called. When an <code>Orange</code> class object is destructed, the order of destructor calls must be the reverse of the order of constructor calls. In our case, the <code>Orange</code> destructor is first called, followed by the <code>Drug</code> destructor is called, followed by the <code>Fruit</code> destructor is called. When an <code>Orange</code> class object is destroyed via an <code>Orange</code> class pointer or a <code>Fruit</code> class base pointer, The deleting destructor of the <code>Orange</code> class will be called via the vtable. Before the deleting destructor gets returned, the <code>Drug</code> and <code>Fruit</code> base class destructors are called and finally the <code>Orange</code> class object is deallocated from the memory.</li>
<li><code>32    (int (*)(...))Orange::foo</code> is the pointer to the overriding functions for <code>Fruit::foo</code>. So even if it is a <code>Fruit</code> base class pointer pointing to an <code>Orange</code> class object, it can always find the overriding function <code>Orange::foo</code> correctly via the vtable. Note that even though the <code>Drug</code> base class also has a virtual function <code>Drug::foo</code> that’s also overridden by <code>Orange::foo</code>, this <code>Orange::foo</code> does not belong to the <code>Drug</code> base class vtable and is not accessible via a <code>Drug</code> base class pointer.</li>
<li><code>40    (int (*)(...))Orange::bar</code> is the pointer to the overriding functions for <code>Fruit::bar</code>. So even if it is a <code>Fruit</code> base class pointer pointing to an <code>Orange</code> class object, it can always find the overriding function <code>Orange::bar</code> correctly via the vtable.</li>
<li><code>48    (int (*)(...))Orange::baz</code> is the pointer to the overriding functions for <code>Drug::baz</code>. This <code>Orange::baz</code> only belongs to the <code>Orange</code> class vtable and it only accessible via a <code>Orange</code> class pointer.</li>
<li><code>56    (int (*)(...))Orange::orange_bar</code> is the pointer to the new virtual function <code>Orange::orange_bar</code> for the <code>Orange</code> class. It belongs to the <code>Orange</code> class vtable and is only accessible via an <code>Orange</code> class pointer, even though the <code>Orange</code> class vtable is just extended from the <code>Fruit</code> class vtable on the memory. </li>
<li><code>64    (int (*)(...))-24</code> is the offset-to-top value for the <code>Drug</code> class pointer adjustment. Suppose the address of a <code>Drug</code> pointer pointing to a <code>Orange</code> class object is <code>x</code>, then the address to the actual <code>Orange</code> class object is <code>x - 24</code>. Suppose the address of a <code>Drug</code> pointer pointing to a <code>Drug</code> class object is <code>x</code>, as we have seen in the <code>Drug</code> class vtable, the offset-to-top value is <code>0</code> instead of <code>-24</code>. So there is no point adjustment if the actual object is a <code>Drug</code> class object. Using this mechanism, C++ can dynamically change the polymorphic class correctly from the base class pointers during runtime.</li>
<li><code>72    (int (*)(...))(&amp; _ZTI6Orange)</code> is the typeinfo pointer to the type information of the <code>Orange</code> class.</li>
<li><code>80    (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</code> and <code>88    (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</code> are the function pointers to complete object destructor and the deleting destructor. They are almost the same as the <code>16    (int (*)(...))Orange::~Orange</code> and <code>24    (int (*)(...))Orange::~Orange</code>. The difference is that they belong to the <code>Drug</code> class vtable and can only be accessed by the <code>Drug</code> base class pointer. The implementation of <code>80    (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</code> and <code>88    (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</code> might involve the <code>this</code> pointer adjustment so that <code>16    (int (*)(...))Orange::~Orange</code> and <code>24    (int (*)(...))Orange::~Orange</code> is actually called for destruction. But it can just be compiler dependent.</li>
<li><code>96    (int (*)(...))Orange::_ZThn24_N6Orange3fooEv</code> is the the pointer to the overriding functions for <code>Drug::foo</code>. So even if it is a <code>Drug</code> base class pointer pointing to an <code>Orange</code> class object, it can always find the overriding function <code>Orange::foo</code> correctly via the vtable. It belongs to the <code>Drug</code> class vtable and can only be accessed by the <code>Drug</code> base class pointer.</li>
<li><code>104   (int (*)(...))Orange::_ZThn24_N6Orange3bazEv</code> is the the pointer to the overriding functions for <code>Drug::baz</code>. So even if it is a <code>Drug</code> base class pointer pointing to an <code>Orange</code> class object, it can always find the overriding function <code>Orange::baz</code> correctly via the vtable. It belongs to the <code>Drug</code> class vtable and can only be accessed by the <code>Drug</code> base class pointer.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class Orange</span><br><span class="line">   size=48 align=8</span><br><span class="line">   base size=48 base align=8</span><br><span class="line">Orange (0x0x7f79a8d81770) 0</span><br><span class="line">    vptr=((&amp; Orange::_ZTV6Orange) + 16)</span><br><span class="line">Fruit (0x0x7f79a8d6de40) 0</span><br><span class="line">      primary-for Orange (0x0x7f79a8d81770)</span><br><span class="line">Drug (0x0x7f79a8d6dea0) 24</span><br><span class="line">      vptr=((&amp; Orange::_ZTV6Orange) + 80)</span><br></pre></td></tr></table></figure>

<p>The base size of the <code>Orange</code> class object is <code>sizeof(Fruit) + sizeof(Drug) + sizeof(Orange::m_weight) = 24 + 16 + 8 = 48</code> bytes, and it happens to meet the alignment requirement. The <code>Drug</code> base class component offset to the beginning of the <code>Orange</code> class is 24 bytes, which means it’s arranged after the <code>Fruit</code> class components on the stack memory. It makes sense because the <code>Fruit</code> class is the primary base class for the <code>Orange</code> class.</p>
<p>The vtable pointer <code>vptr</code> for the <code>Orange</code> class and the <code>Fruit</code> class are shared and it points to the first destructor function of <code>Orange</code>, <code>16    (int (*)(...))Orange::~Orange</code>. There is another vtable pointer <code>vptr</code> for the <code>Drug</code> class and it points to the first destructor function of <code>Orange</code>, <code>80    (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</code>.</p>
<h3 id="Class-Memory-Layout"><a href="#Class-Memory-Layout" class="headerlink" title="Class Memory Layout"></a>Class Memory Layout</h3><p>Using <code>pahole</code>, we could also verify the class object memory layouts and the vtable entries.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">$ pahole inheritance</span><br><span class="line">class Orange : public Fruit, public Drug &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Fruit               &lt;ancestor&gt;; */      /*     0    24 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 3 bytes of padding */</span><br><span class="line"></span><br><span class="line">        /* class Drug                &lt;ancestor&gt;; */      /*    24    16 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 4 bytes of padding */</span><br><span class="line">        void Orange(class Orange *, const class Orange  &amp;);</span><br><span class="line"></span><br><span class="line">        void Orange(class Orange *, double, int, char, double);</span><br><span class="line"></span><br><span class="line">        virtual void ~Orange(class Orange *, int);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Orange *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Orange *);</span><br><span class="line"></span><br><span class="line">        virtual void baz(class Orange *);</span><br><span class="line"></span><br><span class="line">        void get_weight(const class Orange  *);</span><br><span class="line"></span><br><span class="line">        virtual void orange_bar(class Orange *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        double                     m_weight;             /*    40     8 */</span><br><span class="line">        /* vtable has 4 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = bar((null)), </span><br><span class="line">           [4] = baz((null)), </span><br><span class="line">           [5] = orange_bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 48, cachelines: 1, members: 3 */</span><br><span class="line">        /* paddings: 2, <span class="built_in">sum</span> paddings: 7 */</span><br><span class="line">        /* last cacheline: 48 bytes */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 48 bytes != 8 (member bytes) + 0 (member bits) + 0 (byte holes) + 0 (bit holes), diff = 320 bits */</span><br><span class="line">&#125;;</span><br><span class="line">class Fruit &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void Fruit(class Fruit *, const class Fruit  &amp;);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Fruit;          /*     0     8 */</span><br><span class="line">        void Fruit(class Fruit *, double, int, char);</span><br><span class="line"></span><br><span class="line">        virtual void ~Fruit(class Fruit *, int);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Fruit *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Fruit *);</span><br><span class="line"></span><br><span class="line">        double                     m_size;               /*     8     8 */</span><br><span class="line">        int                        m_id;                 /*    16     4 */</span><br><span class="line">        char                       m_country;            /*    20     1 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 24, cachelines: 1, members: 4 */</span><br><span class="line">        /* padding: 3 */</span><br><span class="line">        /* last cacheline: 24 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Drug &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void Drug(class Drug *, const class Drug  &amp;);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Drug;           /*     0     8 */</span><br><span class="line">        void Drug(class Drug *, int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Drug(class Drug *, int);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Drug *);</span><br><span class="line"></span><br><span class="line">        virtual void baz(class Drug *);</span><br><span class="line"></span><br><span class="line">        int                        m_property;           /*     8     4 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = baz((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 16, cachelines: 1, members: 2 */</span><br><span class="line">        /* padding: 4 */</span><br><span class="line">        /* last cacheline: 16 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Apple : public Fruit &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Fruit               &lt;ancestor&gt;; */      /*     0    24 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 3 bytes of padding */</span><br><span class="line">        void Apple(class Apple *, const class Apple  &amp;);</span><br><span class="line"></span><br><span class="line">        void Apple(class Apple *, double, int, char, int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Apple(class Apple *, int);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Apple *);</span><br><span class="line"></span><br><span class="line">        void get_color(const class Apple  *);</span><br><span class="line"></span><br><span class="line">        virtual void apple_foo(class Apple *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        int                        m_color;              /*    24     4 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [4] = apple_foo((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 32, cachelines: 1, members: 2 */</span><br><span class="line">        /* padding: 4 */</span><br><span class="line">        /* paddings: 1, <span class="built_in">sum</span> paddings: 3 */</span><br><span class="line">        /* last cacheline: 32 bytes */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 32 bytes != 4 (member bytes) + 0 (member bits) + 0 (byte holes) + 0 (bit holes), diff = 192 bits */</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



























<h2 id="Virtual-Inheritance"><a href="#Virtual-Inheritance" class="headerlink" title="Virtual Inheritance"></a>Virtual Inheritance</h2><p>Unlike the non-virtual inheritance described above, virtual inheritance uses the keyword <code>virtual</code> for the access specifiers, including <code>private</code>, <code>public</code>, and <code>protected</code>. The class that a class inherits with a <code>virtual</code> keyword is called the virtual base class.  </p>
<p>The difference between the conventional non-virtual inheritance and the virtual inheritance is that virtual inheritance allows diamond hierarchy and only one instance of the virtual base class will be created. In the following example, when class <code>A</code> is the virtual base class for both class <code>B</code> and <code>C</code>, and an object of class <code>D</code>, which derives from both class <code>B</code> and <code>C</code>, is created, only one subobject of class <code>A</code> will be created.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  A</span><br><span class="line"> / \</span><br><span class="line">B   C</span><br><span class="line"> \ /</span><br><span class="line">  D</span><br></pre></td></tr></table></figure>

<p>If class <code>A</code> is not a virtual base class for both class <code>B</code> and <code>C</code>, two subobjects of class <code>A</code> will be created. In some scenarios, this is undesired or unnecessary.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A   A</span><br><span class="line">|   |</span><br><span class="line">B   C</span><br><span class="line"> \ /</span><br><span class="line">  D</span><br></pre></td></tr></table></figure>


<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><p>The following example created five classes <code>Item</code>, <code>Fruit</code>, <code>Drug</code>, <code>Apple</code>, and <code>Orange</code>. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Item</span><br><span class="line">  |</span><br><span class="line">Fruit</span><br><span class="line">  |</span><br><span class="line">Apple</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    Item </span><br><span class="line">  /      \</span><br><span class="line">Fruit   Drug</span><br><span class="line">  \      /</span><br><span class="line">   Orange</span><br></pre></td></tr></table></figure>

<p>The <code>Item</code> class is a virtual base for both the <code>Fruit</code> and <code>Drug</code> class. The <code>Apple</code> class inherits from the <code>Fruit</code> class. The <code>Orange</code> class inherits from multiple classes, including the <code>Fruit</code> class and the <code>Drug</code> class. This time, because the <code>Item</code> class is virtually inherited by both the <code>Fruit</code> and <code>Drug</code> class, only one instance of the <code>Item</code> subobject will be created for the <code>Orange</code> object.</p>
<figure class="highlight c++"><figcaption><span>virtual_inheritance.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Item</span>(<span class="type">long</span> <span class="type">long</span> item_id) : m_item_id&#123;item_id&#125; &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Item</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">qux</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">quux</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> m_item_id;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Drug</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Item</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Drug</span>(<span class="type">int</span> property) : m_property&#123;property&#125;, Item&#123;<span class="number">0LL</span>&#125; &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Drug</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">baz</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">qux</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;&#125;;</span><br><span class="line">    <span class="type">int</span> m_property;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fruit</span> : <span class="keyword">virtual</span> <span class="keyword">public</span> Item</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Fruit</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country)</span><br><span class="line">        : m_size&#123;size&#125;, m_id&#123;id&#125;, m_country&#123;country&#125;, Item&#123;<span class="number">0LL</span>&#125; &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Fruit</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bar</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">quux</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;&#125;;</span><br><span class="line">    <span class="type">double</span> m_size;</span><br><span class="line">    <span class="type">int</span> m_id;</span><br><span class="line">    <span class="type">char</span> m_country;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Apple</span> : <span class="keyword">public</span> Fruit</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Apple</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country, <span class="type">int</span> color, <span class="type">long</span> <span class="type">long</span> item_id)</span><br><span class="line">        : Fruit&#123;size, id, country&#125;, m_color&#123;color&#125;, Item&#123;item_id&#125; &#123;&#125;;</span><br><span class="line">    ~<span class="built_in">Apple</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_color</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">apple_foo</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="type">int</span> m_color;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Orange</span> : <span class="keyword">public</span> Fruit, <span class="keyword">public</span> Drug</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Orange</span>(<span class="type">double</span> size, <span class="type">int</span> id, <span class="type">char</span> country, <span class="type">double</span> weight, <span class="type">long</span> <span class="type">long</span> item_id)</span><br><span class="line">        : Fruit&#123;size, id, country&#125;, Drug&#123;<span class="number">4</span>&#125;, m_weight&#123;weight&#125;, Item&#123;item_id&#125; &#123;&#125;;</span><br><span class="line">    ~<span class="built_in">Orange</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="comment">// Overriding Fruit virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Overriding Drug virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">baz</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Orange non-virtual functions.</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">get_weight</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Orange virtual functions.</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">orange_bar</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="type">double</span> m_weight;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> <span class="type">const</span> apple_item_id&#123;<span class="number">1000LL</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> apple_size&#123;<span class="number">1.0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> apple_id&#123;<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="type">char</span> <span class="type">const</span> apple_country&#123;<span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> apple_color&#123;<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> <span class="type">const</span> orange_item_id&#123;<span class="number">1001LL</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> orange_size&#123;<span class="number">0.8</span>&#125;;</span><br><span class="line">    <span class="type">int</span> <span class="type">const</span> orange_id&#123;<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="type">char</span> <span class="type">const</span> orange_country&#123;<span class="string">&#x27;n&#x27;</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> orange_weight&#123;<span class="number">0.6</span>&#125;;</span><br><span class="line">    Apple apple&#123;apple_size, apple_id, apple_country, apple_color,</span><br><span class="line">                apple_item_id&#125;;</span><br><span class="line">    Orange orange&#123;orange_size, orange_id, orange_country, orange_weight,</span><br><span class="line">                  orange_item_id&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Class-Hierarchy-Virtual-Table-and-Virtual-Table-Table"><a href="#Class-Hierarchy-Virtual-Table-and-Virtual-Table-Table" class="headerlink" title="Class Hierarchy, Virtual Table, and Virtual Table Table"></a>Class Hierarchy, Virtual Table, and Virtual Table Table</h3><p>In the same way, we could dump class hierarchy information, including the virtual table information, using <code>-fdump-lang-class</code> for the GCC compiler. However, suddenly, the information becomes very complicated because of the virtual inheritance. There is also an addition field <code>VTT</code>, i.e., virtual table table or vtable table, which includes the transient vtables used for object construction and destruction. We will discuss virtual table table in my article <a href="/blog/CPP-Virtual-Table-Table/">“C++ Virtual Table Table”</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">$ g++ -g -fdump-lang-class virtual_inheritance.cpp -o virtual_inheritance</span><br><span class="line">$ <span class="built_in">cat</span> virtual_inheritance.cpp.001l.class </span><br><span class="line">Vtable <span class="keyword">for</span> Item</span><br><span class="line">Item::_ZTV4Item: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI4Item)</span><br><span class="line">16    (int (*)(...))Item::~Item</span><br><span class="line">24    (int (*)(...))Item::~Item</span><br><span class="line">32    (int (*)(...))Item::qux</span><br><span class="line">40    (int (*)(...))Item::quux</span><br><span class="line"></span><br><span class="line">Class Item</span><br><span class="line">   size=16 align=8</span><br><span class="line">   base size=16 base align=8</span><br><span class="line">Item (0x0x7fa3f5d6d420) 0</span><br><span class="line">    vptr=((&amp; Item::_ZTV4Item) + <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Drug</span><br><span class="line">Drug::_ZTV4Drug: <span class="number">17</span> entries</span><br><span class="line"><span class="number">0</span>     <span class="number">16</span></span><br><span class="line"><span class="number">8</span>     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">56    (int (*)(...))Drug::qux</span><br><span class="line">64    0</span><br><span class="line">72    18446744073709551600</span><br><span class="line">80    18446744073709551600</span><br><span class="line">88    (int (*)(...))-16</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</span><br><span class="line">128   (int (*)(...))Item::quux</span><br><span class="line"></span><br><span class="line">VTT <span class="keyword">for</span> Drug</span><br><span class="line">Drug::_ZTT4Drug: 2 entries</span><br><span class="line">0     ((&amp; Drug::_ZTV4Drug) + <span class="number">24</span>)</span><br><span class="line"><span class="number">8</span>     ((&amp; Drug::_ZTV4Drug) + <span class="number">104</span>)</span><br><span class="line"></span><br><span class="line">Class Drug</span><br><span class="line">   size=<span class="number">32</span> align=<span class="number">8</span></span><br><span class="line">   base size=<span class="number">12</span> base align=<span class="number">8</span></span><br><span class="line">Drug (<span class="number">0</span>x0x7fa3f5c0e340) <span class="number">0</span></span><br><span class="line">    vptridx=<span class="number">0</span> vptr=((&amp; Drug::_ZTV4Drug) + <span class="number">24</span>)</span><br><span class="line">Item (<span class="number">0</span>x0x7fa3f5d6d780) <span class="number">16</span> virtual</span><br><span class="line">      vptridx=<span class="number">8</span> vbaseoffset=-<span class="number">24</span> vptr=((&amp; Drug::_ZTV4Drug) + <span class="number">104</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Fruit</span><br><span class="line">Fruit::_ZTV5Fruit: <span class="number">17</span> entries</span><br><span class="line"><span class="number">0</span>     <span class="number">24</span></span><br><span class="line"><span class="number">8</span>     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    18446744073709551592</span><br><span class="line">72    0</span><br><span class="line">80    18446744073709551592</span><br><span class="line">88    (int (*)(...))-24</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Item::qux</span><br><span class="line">128   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br><span class="line"></span><br><span class="line">VTT <span class="keyword">for</span> Fruit</span><br><span class="line">Fruit::_ZTT5Fruit: 2 entries</span><br><span class="line">0     ((&amp; Fruit::_ZTV5Fruit) + <span class="number">24</span>)</span><br><span class="line"><span class="number">8</span>     ((&amp; Fruit::_ZTV5Fruit) + <span class="number">104</span>)</span><br><span class="line"></span><br><span class="line">Class Fruit</span><br><span class="line">   size=<span class="number">40</span> align=<span class="number">8</span></span><br><span class="line">   base size=<span class="number">21</span> base align=<span class="number">8</span></span><br><span class="line">Fruit (<span class="number">0</span>x0x7fa3f5c0e478) <span class="number">0</span></span><br><span class="line">    vptridx=<span class="number">0</span> vptr=((&amp; Fruit::_ZTV5Fruit) + <span class="number">24</span>)</span><br><span class="line">Item (<span class="number">0</span>x0x7fa3f5d6dae0) <span class="number">24</span> virtual</span><br><span class="line">      vptridx=<span class="number">8</span> vbaseoffset=-<span class="number">24</span> vptr=((&amp; Fruit::_ZTV5Fruit) + <span class="number">104</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Apple</span><br><span class="line">Apple::_ZTV5Apple: <span class="number">18</span> entries</span><br><span class="line"><span class="number">0</span>     <span class="number">32</span></span><br><span class="line"><span class="number">8</span>     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">24    (int (*)(...))Apple::~Apple</span><br><span class="line">32    (int (*)(...))Apple::~Apple</span><br><span class="line">40    (int (*)(...))Apple::foo</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    (int (*)(...))Apple::apple_foo</span><br><span class="line">72    18446744073709551584</span><br><span class="line">80    0</span><br><span class="line">88    18446744073709551584</span><br><span class="line">96    (int (*)(...))-32</span><br><span class="line">104   (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">112   (int (*)(...))Apple::_ZTv0_n24_N5AppleD1Ev</span><br><span class="line">120   (int (*)(...))Apple::_ZTv0_n24_N5AppleD0Ev</span><br><span class="line">128   (int (*)(...))Item::qux</span><br><span class="line">136   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br><span class="line"></span><br><span class="line">Construction vtable <span class="keyword">for</span> Fruit (0x0x7fa3f5c0e5b0 instance) <span class="keyword">in</span> Apple</span><br><span class="line">Apple::_ZTC5Apple0_5Fruit: 17 entries</span><br><span class="line">0     32</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    18446744073709551584</span><br><span class="line">72    0</span><br><span class="line">80    18446744073709551584</span><br><span class="line">88    (int (*)(...))-32</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Item::qux</span><br><span class="line">128   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br><span class="line"></span><br><span class="line">VTT <span class="keyword">for</span> Apple</span><br><span class="line">Apple::_ZTT5Apple: 4 entries</span><br><span class="line">0     ((&amp; Apple::_ZTV5Apple) + <span class="number">24</span>)</span><br><span class="line"><span class="number">8</span>     ((&amp; Apple::_ZTC5Apple0_5Fruit) + <span class="number">24</span>)</span><br><span class="line"><span class="number">16</span>    ((&amp; Apple::_ZTC5Apple0_5Fruit) + <span class="number">104</span>)</span><br><span class="line"><span class="number">24</span>    ((&amp; Apple::_ZTV5Apple) + <span class="number">112</span>)</span><br><span class="line"></span><br><span class="line">Class Apple</span><br><span class="line">   size=<span class="number">48</span> align=<span class="number">8</span></span><br><span class="line">   base size=<span class="number">28</span> base align=<span class="number">8</span></span><br><span class="line">Apple (<span class="number">0</span>x0x7fa3f5c0e548) <span class="number">0</span></span><br><span class="line">    vptridx=<span class="number">0</span> vptr=((&amp; Apple::_ZTV5Apple) + <span class="number">24</span>)</span><br><span class="line">Fruit (<span class="number">0</span>x0x7fa3f5c0e5b0) <span class="number">0</span></span><br><span class="line">      primary-for Apple (<span class="number">0</span>x0x7fa3f5c0e548)</span><br><span class="line">      subvttidx=<span class="number">8</span></span><br><span class="line">Item (<span class="number">0</span>x0x7fa3f5d6dde0) <span class="number">32</span> virtual</span><br><span class="line">        vptridx=<span class="number">24</span> vbaseoffset=-<span class="number">24</span> vptr=((&amp; Apple::_ZTV5Apple) + <span class="number">112</span>)</span><br><span class="line"></span><br><span class="line">Vtable for Orange</span><br><span class="line">Orange::_ZTV6Orange: <span class="number">27</span> entries</span><br><span class="line"><span class="number">0</span>     <span class="number">48</span></span><br><span class="line"><span class="number">8</span>     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">24    (int (*)(...))Orange::~Orange</span><br><span class="line">32    (int (*)(...))Orange::~Orange</span><br><span class="line">40    (int (*)(...))Orange::foo</span><br><span class="line">48    (int (*)(...))Orange::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    (int (*)(...))Orange::baz</span><br><span class="line">72    (int (*)(...))Orange::orange_bar</span><br><span class="line">80    24</span><br><span class="line">88    (int (*)(...))-24</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">104   (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</span><br><span class="line">112   (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</span><br><span class="line">120   (int (*)(...))Orange::_ZThn24_N6Orange3fooEv</span><br><span class="line">128   (int (*)(...))Orange::_ZThn24_N6Orange3bazEv</span><br><span class="line">136   (int (*)(...))Drug::qux</span><br><span class="line">144   18446744073709551568</span><br><span class="line">152   18446744073709551592</span><br><span class="line">160   18446744073709551568</span><br><span class="line">168   (int (*)(...))-48</span><br><span class="line">176   (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">184   (int (*)(...))Orange::_ZTv0_n24_N6OrangeD1Ev</span><br><span class="line">192   (int (*)(...))Orange::_ZTv0_n24_N6OrangeD0Ev</span><br><span class="line">200   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</span><br><span class="line">208   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br><span class="line"></span><br><span class="line">Construction vtable <span class="keyword">for</span> Fruit (0x0x7fa3f5c0e6e8 instance) <span class="keyword">in</span> Orange</span><br><span class="line">Orange::_ZTC6Orange0_5Fruit: 17 entries</span><br><span class="line">0     48</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    18446744073709551568</span><br><span class="line">72    0</span><br><span class="line">80    18446744073709551568</span><br><span class="line">88    (int (*)(...))-48</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Item::qux</span><br><span class="line">128   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br><span class="line"></span><br><span class="line">Construction vtable <span class="keyword">for</span> Drug (0x0x7fa3f5c0e750 instance) <span class="keyword">in</span> Orange</span><br><span class="line">Orange::_ZTC6Orange24_4Drug: 17 entries</span><br><span class="line">0     24</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">56    (int (*)(...))Drug::qux</span><br><span class="line">64    0</span><br><span class="line">72    18446744073709551592</span><br><span class="line">80    18446744073709551592</span><br><span class="line">88    (int (*)(...))-24</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</span><br><span class="line">128   (int (*)(...))Item::quux</span><br><span class="line"></span><br><span class="line">VTT <span class="keyword">for</span> Orange</span><br><span class="line">Orange::_ZTT6Orange: 7 entries</span><br><span class="line">0     ((&amp; Orange::_ZTV6Orange) + <span class="number">24</span>)</span><br><span class="line"><span class="number">8</span>     ((&amp; Orange::_ZTC6Orange0_5Fruit) + <span class="number">24</span>)</span><br><span class="line"><span class="number">16</span>    ((&amp; Orange::_ZTC6Orange0_5Fruit) + <span class="number">104</span>)</span><br><span class="line"><span class="number">24</span>    ((&amp; Orange::_ZTC6Orange24_4Drug) + <span class="number">24</span>)</span><br><span class="line"><span class="number">32</span>    ((&amp; Orange::_ZTC6Orange24_4Drug) + <span class="number">104</span>)</span><br><span class="line"><span class="number">40</span>    ((&amp; Orange::_ZTV6Orange) + <span class="number">184</span>)</span><br><span class="line"><span class="number">48</span>    ((&amp; Orange::_ZTV6Orange) + <span class="number">104</span>)</span><br><span class="line"></span><br><span class="line">Class Orange</span><br><span class="line">   size=<span class="number">64</span> align=<span class="number">8</span></span><br><span class="line">   base size=<span class="number">48</span> base align=<span class="number">8</span></span><br><span class="line">Orange (<span class="number">0</span>x0x7fa3f5d82c40) <span class="number">0</span></span><br><span class="line">    vptridx=<span class="number">0</span> vptr=((&amp; Orange::_ZTV6Orange) + <span class="number">24</span>)</span><br><span class="line">Fruit (<span class="number">0</span>x0x7fa3f5c0e6e8) <span class="number">0</span></span><br><span class="line">      primary-for Orange (<span class="number">0</span>x0x7fa3f5d82c40)</span><br><span class="line">      subvttidx=<span class="number">8</span></span><br><span class="line">Item (<span class="number">0</span>x0x7fa3f5da7600) <span class="number">48</span> virtual</span><br><span class="line">        vptridx=<span class="number">40</span> vbaseoffset=-<span class="number">24</span> vptr=((&amp; Orange::_ZTV6Orange) + <span class="number">184</span>)</span><br><span class="line">Drug (<span class="number">0</span>x0x7fa3f5c0e750) <span class="number">24</span></span><br><span class="line">      subvttidx=<span class="number">24</span> vptridx=<span class="number">48</span> vptr=((&amp; Orange::_ZTV6Orange) + <span class="number">104</span>)</span><br><span class="line">Item (<span class="number">0</span>x0x7fa3f5da7600) alternative-path</span><br></pre></td></tr></table></figure>

<p>We will go through the class hierarchy information, including the virtual table information, for each class in detail.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Item</span><br><span class="line">Item::_ZTV4Item: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI4Item)</span><br><span class="line">16    (int (*)(...))Item::~Item</span><br><span class="line">24    (int (*)(...))Item::~Item</span><br><span class="line">32    (int (*)(...))Item::qux</span><br><span class="line">40    (int (*)(...))Item::quux</span><br><span class="line"></span><br><span class="line">Class Item</span><br><span class="line">   size=16 align=8</span><br><span class="line">   base size=16 base align=8</span><br><span class="line">Item (0x0x7fa3f5d6d420) 0</span><br><span class="line">    vptr=((&amp; Item::_ZTV4Item) + 16)</span><br></pre></td></tr></table></figure>

<p>Understanding the <code>Item</code> class is straightforward given we what have discussed in the previous sections.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Drug</span><br><span class="line">Drug::_ZTV4Drug: 17 entries</span><br><span class="line">0     16</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">56    (int (*)(...))Drug::qux</span><br><span class="line">64    0</span><br><span class="line">72    18446744073709551600</span><br><span class="line">80    18446744073709551600</span><br><span class="line">88    (int (*)(...))-16</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI4Drug)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</span><br><span class="line">128   (int (*)(...))Item::quux</span><br></pre></td></tr></table></figure>

<p><code>Drug::_ZTV4Drug: 17 entries</code> says the vtable name is <code>Drug::_ZTV4Drug</code> and there are 17 function pointer entries in the vtable. The offset of each entry is <code>8</code> bytes. Because the <code>Drug</code> class virtually inherits the <code>Item</code> class, the vtable looks more complicated than the previous ones we have seen. The major complications come from the additional entries.</p>
<ul>
<li><code>0     16</code> is the virtual-base-offset or vbase-offset which we have not seen in the vtable without virtual inheritance. Given the derived class <code>Drug</code> pointer, by adding the vbase-offset to the <code>Drug</code> class pointer, we could get the virtual base class pointer. Notice because the class <code>Item</code> is a virtual base for the <code>Drug</code> class, unlike the non-virtual inheritance, it’s not constructed at the offset 0 to the <code>Drug</code> class.</li>
<li><code>64    0</code>, <code>72    18446744073709551600</code>, and <code>80    18446744073709551600</code> are the virtual-call-offsets or vcall-offsets for the virtual base <code>Item</code> class pointer. It’s used for adjusting the <code>this</code> pointer used in the virtual functions from the virtual base class. Because there are three virtual functions in the virtual base <code>Item</code> class, including <code>Item::~Item</code>, <code>Item::qux</code>, and <code>Item::quux</code>, we have three virtual-call-offsets for them. Although I am not exactly sure about which virtual-call-offset is used for which virtual function, my best educative guess is, the last virtual-call-offset <code>80    18446744073709551600</code> is used for the virtual destructor <code>Item::~Item</code>, the last but one virtual-call-offset <code>72    18446744073709551600</code> is used for <code>Item::qux</code>, and the first virtual-call-offset <code>64    0</code> is used for <code>Item::quux</code>. This educative guess seems to be consistent for other classes as well. For example, the <code>Item::qux</code> virtual function has been overridden by the <code>Drug::qux</code> function, whereas the <code>Item::quux</code> virtual function has not. When the <code>Drug::qux</code> function is invoked via the virtual base <code>Item</code> class pointer through the <code>120   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</code> entry in the vtable, a derived class <code>Drug</code> object should be passed to the function. But the <code>this</code> pointer actually points to the virtual base <code>Item</code> class object. To get the pointer pointing to the <code>Drug</code> object, <code>72    18446744073709551600</code> is added to the <code>this</code> pointer. The <code>18446744073709551600</code> value is extremely confusing. But it’s just the two’s complement representation of the signed integer <code>-16</code>. Let’s check more specifically. The binary representation of <code>18446744073709551600</code> is <code>111111111111111111111111111111111111111111111111111111111110000</code>. The MSB is <code>1</code>, indicating a negative number. Inverting all the bits results in <code>000000000000000000000000000000000000000000000000000000000001111</code>. Adding <code>1</code> to the inverted binary number gives <code>000000000000000000000000000000000000000000000000000000000010000</code>. The resulting binary number, <code>000000000000000000000000000000000000000000000000000000000010000</code>, is <code>16</code>. The negated decimal value is 16. Then the original value <code>18446744073709551600</code> represents the decimal value <code>-16</code>. Now it makes sense, because <code>this + (-16)</code> will just point to the <code>Drug</code> object. Similarly, for the virtual destructor, since it has been overridden by the <code>Drug</code> class, the same vcall-offset has to be used for adjusting the <code>this</code> pointer used for the destructor so that it points to the <code>Drug</code> object. Finally, where is the vcall-offset <code>64    0</code> is used? Note that the <code>Item::quux</code> has not been overridden by the <code>Drug</code> class, an <code>Item</code> object should be used for the <code>Item::quux</code> function. Since <code>this</code> already points to the <code>Item</code> virtual base object, the offset is <code>0</code>.</li>
</ul>
<p>In addition, notice that even though the <code>Item</code> virtual base class has a virtual function <code>Item::quux</code>, unlike the vtable for the non-virtual inheritance example, it’s not in the entry after <code>56    (int (*)(...))Drug::qux</code>. But a <code>Drug</code> class pointer still have the access to call <code>Item::quux</code>. To do this, the <code>Drug</code> class pointer would be first adjusted to the virtual base <code>Item</code> class pointer using the vbase-offset value, the <code>Item::quux</code> function can be invoked by calling the <code>quux</code> method from the <code>Drug</code> class pointer.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Class Drug</span><br><span class="line">   size=32 align=8</span><br><span class="line">   base size=12 base align=8</span><br><span class="line">Drug (0x0x7fa3f5c0e340) 0</span><br><span class="line">    vptridx=0 vptr=((&amp; Drug::_ZTV4Drug) + 24)</span><br><span class="line">Item (0x0x7fa3f5d6d780) 16 virtual</span><br><span class="line">      vptridx=8 vbaseoffset=-24 vptr=((&amp; Drug::_ZTV4Drug) + 104)</span><br></pre></td></tr></table></figure>


<p>The base size of the <code>Drug</code> class object is <code>sizeof(Drug::vtable) + sizeof(Drug::m_property) = 8 + 4 = 12</code> bytes and it is padded to <code>16</code> bytes because the alignment requirement is <code>8</code> bytes. Notice that because the <code>Item</code> class is a virtual base class, it is not counted in the base size. The <code>Item</code> class object is <code>16</code> bytes. Finally, the size of the <code>Drug</code> class object is <code>sizeof(Drug) + sizeof(Item) = 16 + 16 = 32</code> bytes. There are two vtable pointers. The <code>Drug</code> class vtable pointer points to the <code>24    0</code> entry in the vtable, whereas the <code>Item</code> class vtable pointer points to the <code>104   0</code> entry in the vtable.</p>
<p>Let’s finally take a look at the <code>Orange</code> class. We could use <code>Orange</code>, <code>Fruit</code>, <code>Drug</code>, and <code>Item</code> class pointers pointing to an <code>Orange</code> class object. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Orange</span><br><span class="line">Orange::_ZTV6Orange: 27 entries</span><br><span class="line">0     48</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">24    (int (*)(...))Orange::~Orange</span><br><span class="line">32    (int (*)(...))Orange::~Orange</span><br><span class="line">40    (int (*)(...))Orange::foo</span><br><span class="line">48    (int (*)(...))Orange::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    (int (*)(...))Orange::baz</span><br><span class="line">72    (int (*)(...))Orange::orange_bar</span><br><span class="line">80    24</span><br><span class="line">88    (int (*)(...))-24</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">104   (int (*)(...))Orange::_ZThn24_N6OrangeD1Ev</span><br><span class="line">112   (int (*)(...))Orange::_ZThn24_N6OrangeD0Ev</span><br><span class="line">120   (int (*)(...))Orange::_ZThn24_N6Orange3fooEv</span><br><span class="line">128   (int (*)(...))Orange::_ZThn24_N6Orange3bazEv</span><br><span class="line">136   (int (*)(...))Drug::qux</span><br><span class="line">144   18446744073709551568</span><br><span class="line">152   18446744073709551592</span><br><span class="line">160   18446744073709551568</span><br><span class="line">168   (int (*)(...))-48</span><br><span class="line">176   (int (*)(...))(&amp; _ZTI6Orange)</span><br><span class="line">184   (int (*)(...))Orange::_ZTv0_n24_N6OrangeD1Ev</span><br><span class="line">192   (int (*)(...))Orange::_ZTv0_n24_N6OrangeD0Ev</span><br><span class="line">200   (int (*)(...))Drug::_ZTv0_n32_N4Drug3quxEv</span><br><span class="line">208   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br></pre></td></tr></table></figure>


<ul>
<li><code>0     48</code> is the vbase-offset for the <code>Orange</code> and <code>Fruit</code> class pointers.</li>
<li><code>80    24</code> is the vbase-offset for the <code>Drug</code> class pointers.</li>
<li><code>144   18446744073709551568</code>, <code>152   18446744073709551592</code>, and <code>160   18446744073709551568</code>, which translate to <code>144   -48</code>, <code>152   -24</code>, and <code>160   -48</code> are the vcall-offsets for the <code>Item::quux</code>, <code>Item::qux</code>, and <code>Item::~Item</code> overriding functions. Because <code>Item::quux</code> is overridden by the <code>Fruit::quux</code>, the vcall-offset <code>-48</code> will be used for adjusting the <code>this</code> pointer from pointing to an <code>Item</code> object to pointing to a <code>Fruit</code> object. This is the same for the <code>Item::~Item</code> which is overridden by the <code>Orange::~Orange</code>. Because <code>Item::qux</code> is overridden by the <code>Drug::qux</code>, the vcall-offset <code>-24</code> will be used for adjusting the <code>this</code> pointer from pointing to an <code>Item</code> object to pointing to a <code>Drug</code> object. These offsets are also consistent with the offset-to-top values for the <code>Drug</code> and <code>Item</code> class pointers in the vtable.</li>
</ul>
<p>In addition, if there is a <code>Drug</code> class pointer points to an <code>Orange</code> class object, calling <code>quux</code> function via the <code>Drug</code> class pointer results in calling the <code>Fruit::quux</code> method. This is because the <code>Drug</code> class pointer would be first adjusted to the virtual base <code>Item</code> class pointer. Because the <code>Item::quux</code> virtual function has been overridden by the <code>Fruit::quux</code> function, <code>208   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</code> will be invoked instead.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Class Orange</span><br><span class="line">   size=64 align=8</span><br><span class="line">   base size=48 base align=8</span><br><span class="line">Orange (0x0x7fa3f5d82c40) 0</span><br><span class="line">    vptridx=0 vptr=((&amp; Orange::_ZTV6Orange) + 24)</span><br><span class="line">Fruit (0x0x7fa3f5c0e6e8) 0</span><br><span class="line">      primary-for Orange (0x0x7fa3f5d82c40)</span><br><span class="line">      subvttidx=8</span><br><span class="line">Item (0x0x7fa3f5da7600) 48 virtual</span><br><span class="line">        vptridx=40 vbaseoffset=-24 vptr=((&amp; Orange::_ZTV6Orange) + 184)</span><br><span class="line">Drug (0x0x7fa3f5c0e750) 24</span><br><span class="line">      subvttidx=24 vptridx=48 vptr=((&amp; Orange::_ZTV6Orange) + 104)</span><br><span class="line">Item (0x0x7fa3f5da7600) alternative-path</span><br></pre></td></tr></table></figure>


<p>The <code>Orange</code> class object base size, size, vtable pointers, and memory layout is self-explanatory and is consistent with our understanding of the vtable so far.</p>
<h3 id="Class-Memory-Layout-1"><a href="#Class-Memory-Layout-1" class="headerlink" title="Class Memory Layout"></a>Class Memory Layout</h3><p>Using <code>pahole</code>, we could also verify the class object memory layouts and the vtable entries.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line">$ pahole virtual_inheritance</span><br><span class="line">dwarf_expr: unhandled 0x12 DW_OP_ operation</span><br><span class="line">dwarf_expr: unhandled 0x12 DW_OP_ operation</span><br><span class="line">class Orange : public Fruit, public Drug &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Fruit               &lt;ancestor&gt;; */      /*     0    40 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 19 bytes of padding */</span><br><span class="line">        /* XXX 65520 bytes hole, try to pack */</span><br><span class="line"></span><br><span class="line">        /* class Drug                &lt;ancestor&gt;; */      /*    24    32 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 20 bytes of padding */</span><br><span class="line">        /* XXX 65520 bytes hole, try to pack */</span><br><span class="line">        void Orange(class Orange *, int, const void  * *, const class Orange  &amp;);</span><br><span class="line"></span><br><span class="line">        void Orange(class Orange *, int, const void  * *, double, int, char, double, long long int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Orange(class Orange *, int, const void  * *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Orange *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Orange *);</span><br><span class="line"></span><br><span class="line">        virtual void baz(class Orange *);</span><br><span class="line"></span><br><span class="line">        void get_weight(const class Orange  *);</span><br><span class="line"></span><br><span class="line">        virtual void orange_bar(class Orange *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        double                     m_weight;             /*    40     8 */</span><br><span class="line"></span><br><span class="line">        /* Force padding: */</span><br><span class="line">        double                     :64;</span><br><span class="line">        double                     :64;</span><br><span class="line">        /* vtable has 4 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = bar((null)), </span><br><span class="line">           [5] = baz((null)), </span><br><span class="line">           [6] = orange_bar((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 64, cachelines: 1, members: 3 */</span><br><span class="line">        /* <span class="built_in">sum</span> members: 8, holes: 2, <span class="built_in">sum</span> holes: 131040 */</span><br><span class="line">        /* padding: 16 */</span><br><span class="line">        /* paddings: 2, <span class="built_in">sum</span> paddings: 39 */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 64 bytes != 8 (member bytes) + 0 (member bits) + 131040 (byte holes) + 0 (bit holes), diff = -1048000 bits */</span><br><span class="line">&#125;;</span><br><span class="line">class Fruit : virtual public Item &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* --- cacheline 67108863 boundary (4294967232 bytes) was 63 bytes ago --- */</span><br><span class="line">        /* class Item                &lt;ancestor&gt;; */      /* 4294967295    16 */</span><br><span class="line">        void Fruit(class Fruit *, int, const void  * *, const class Fruit  &amp;);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Fruit;          /*     0     8 */</span><br><span class="line">        void Fruit(class Fruit *, int, const void  * *, double, int, char);</span><br><span class="line"></span><br><span class="line">        virtual void ~Fruit(class Fruit *, int, const void  * *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Fruit *);</span><br><span class="line"></span><br><span class="line">        virtual void bar(class Fruit *);</span><br><span class="line"></span><br><span class="line">        virtual void quux(class Fruit *);</span><br><span class="line"></span><br><span class="line">        double                     m_size;               /*     8     8 */</span><br><span class="line">        int                        m_id;                 /*    16     4 */</span><br><span class="line">        char                       m_country;            /*    20     1 */</span><br><span class="line"></span><br><span class="line">        /* Force padding: */</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        char                       :8;</span><br><span class="line">        /* vtable has 3 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = bar((null)), </span><br><span class="line">           [4] = quux((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 40, cachelines: 1, members: 5 */</span><br><span class="line">        /* padding: 19 */</span><br><span class="line">        /* last cacheline: 40 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Drug : virtual public Item &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* --- cacheline 67108863 boundary (4294967232 bytes) was 63 bytes ago --- */</span><br><span class="line">        /* class Item                &lt;ancestor&gt;; */      /* 4294967295    16 */</span><br><span class="line">        void Drug(class Drug *, int, const void  * *, const class Drug  &amp;);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Drug;           /*     0     8 */</span><br><span class="line">        void Drug(class Drug *, int, const void  * *, int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Drug(class Drug *, int, const void  * *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Drug *);</span><br><span class="line"></span><br><span class="line">        virtual void baz(class Drug *);</span><br><span class="line"></span><br><span class="line">        virtual void qux(class Drug *);</span><br><span class="line"></span><br><span class="line">        int                        m_property;           /*     8     4 */</span><br><span class="line"></span><br><span class="line">        /* Force padding: */</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        /* vtable has 3 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [3] = baz((null)), </span><br><span class="line">           [4] = qux((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 32, cachelines: 1, members: 3 */</span><br><span class="line">        /* padding: 20 */</span><br><span class="line">        /* last cacheline: 32 bytes */</span><br><span class="line">&#125;;</span><br><span class="line">class Apple : public Fruit &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        /* class Fruit               &lt;ancestor&gt;; */      /*     0    40 */</span><br><span class="line"></span><br><span class="line">        /* XXX last struct has 19 bytes of padding */</span><br><span class="line">        /* XXX 65520 bytes hole, try to pack */</span><br><span class="line">        void Apple(class Apple *, int, const void  * *, const class Apple  &amp;);</span><br><span class="line"></span><br><span class="line">        void Apple(class Apple *, int, const void  * *, double, int, char, int, long long int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Apple(class Apple *, int, const void  * *);</span><br><span class="line"></span><br><span class="line">        virtual void foo(class Apple *);</span><br><span class="line"></span><br><span class="line">        void get_color(const class Apple  *);</span><br><span class="line"></span><br><span class="line">        virtual void apple_foo(class Apple *);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        int                        m_color;              /*    24     4 */</span><br><span class="line"></span><br><span class="line">        /* Force padding: */</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        int                        :32;</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [2] = foo((null)), </span><br><span class="line">           [5] = apple_foo((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 48, cachelines: 1, members: 2 */</span><br><span class="line">        /* <span class="built_in">sum</span> members: 4, holes: 1, <span class="built_in">sum</span> holes: 65520 */</span><br><span class="line">        /* padding: 20 */</span><br><span class="line">        /* paddings: 1, <span class="built_in">sum</span> paddings: 19 */</span><br><span class="line">        /* last cacheline: 48 bytes */</span><br><span class="line"></span><br><span class="line">        /* BRAIN FART ALERT! 48 bytes != 4 (member bytes) + 0 (member bits) + 65520 (byte holes) + 0 (bit holes), diff = -523968 bits */</span><br><span class="line">&#125;;</span><br><span class="line">class Item &#123;</span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">        void Item(class Item *, const class Item  &amp;);</span><br><span class="line"></span><br><span class="line">        int ()(void) * *           _vptr.Item;           /*     0     8 */</span><br><span class="line">        void Item(class Item *, long long int);</span><br><span class="line"></span><br><span class="line">        virtual void ~Item(class Item *, int);</span><br><span class="line"></span><br><span class="line">        virtual void qux(class Item *);</span><br><span class="line"></span><br><span class="line">        virtual void quux(class Item *);</span><br><span class="line"></span><br><span class="line">        long long int              m_item_id;            /*     8     8 */</span><br><span class="line">        /* vtable has 2 entries: &#123;</span><br><span class="line">           [2] = qux((null)), </span><br><span class="line">           [3] = quux((null)), </span><br><span class="line">        &#125; */</span><br><span class="line">        /* size: 16, cachelines: 1, members: 2 */</span><br><span class="line">        /* last cacheline: 16 bytes */</span><br><span class="line">&#125; __attribute__((__packed__));</span><br></pre></td></tr></table></figure>






<h2 id="FAQs"><a href="#FAQs" class="headerlink" title="FAQs"></a>FAQs</h2><h3 id="Why-There-Are-Two-Destructors-In-the-Virtual-Table"><a href="#Why-There-Are-Two-Destructors-In-the-Virtual-Table" class="headerlink" title="Why There Are Two Destructors In the Virtual Table?"></a>Why There Are Two Destructors In the Virtual Table?</h3><p>There are actually three types destructors.</p>
<ul>
<li>Base object destructor of a class <code>T</code><br>A function that runs the destructors for non-static data members of <code>T</code> and non-virtual direct base classes of <code>T</code>.</li>
</ul>
<ul>
<li>Complete object destructor of a class <code>T</code><br>A function that, in addition to the actions required of a base object destructor, runs the destructors for the virtual base classes of <code>T</code>.</li>
</ul>
<ul>
<li>Deleting destructor of a class <code>T</code><br>A function that, in addition to the actions required of a complete object destructor, calls the appropriate deallocation function (i.e,. operator delete) for <code>T</code>.</li>
</ul>
<p>The complete object destructor and deleting destructor are generated by the compiler and are used via the vtable.</p>
<p>Sometimes, we would like to only destroy the object without deallocating the memory or deallocating the memory separately. The complete object destructor and deleting destructor become useful in this situation. Please see my previous article <a href="/blog/CPP-Dynamic-Memory-Management/">“C++ Dynamic Memory Management”</a> for more information.</p>
<h3 id="Why-Constructors-Are-Not-In-the-Virtual-Table"><a href="#Why-Constructors-Are-Not-In-the-Virtual-Table" class="headerlink" title="Why Constructors Are Not In the Virtual Table?"></a>Why Constructors Are Not In the Virtual Table?</h3><p>There are no virtual constructors. Therefore, they are not in the vtable.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>We have seen what vtable is and how vtable is critically used for C++ runtime polymorphisms. However, we would not discuss why vtable is designed in such a way and whether it is optimal or not here, since it is too complicated.</p>
<!-- 

The base object destructor is useful for not deleting the virtual base object twice.

Suppose we have the following inheritance diagram, and the construction order is `A`, `B`, `C`, and `D`.

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  A  </span><br><span class="line"> / \  </span><br><span class="line">B   C  </span><br><span class="line"> \ /  </span><br><span class="line">  D </span><br></pre></td></tr></table></figure>

<p>The destruction order is just the reverse of the construction order. So it is <code>D</code>, <code>C</code>, <code>B</code>, and <code>A</code>. Because both <code>B</code> and <code>C</code> are derived from <code>A</code>, one of the <code>B</code> and <code>C</code> destructors should be </p>
<p> –&gt;</p>
<!-- 


The two destructors are used for the objects that have multiple virtual inheritance in which the virtual base object will only be constructed and destructed once. 




base object destructor of a class T

A function that runs the destructors for non-static data members of T and non-virtual direct base classes of T.


complete object destructor of a class T

A function that, in addition to the actions required of a base object destructor, runs the destructors for the virtual base classes of T.


deleting destructor of a class T

A function that, in addition to the actions required of a complete object destructor, calls the appropriate deallocation function (i.e,. operator delete) for T.

Remember, the first destructor, called the complete object destructor, performs the destruction without calling `delete()` on the object. The second destructor, called the deleting destructor, calls `delete()` after destroying the object. 


Both destroy any virtual bases; a separate, non-virtual function, called the base object destructor, performs destruction of the object but not its virtual base subobjects, and does not call `delete()`. As we will see later, this design allows the correct destruction of an object without double destruction and deallocation. 

 -->




















<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable-components">Itanium C++ ABI - Virtual Table Components and Order</a></li>
<li><a target="_blank" rel="noopener" href="https://nimrod.blog/posts/what-does-cpp-object-layout-look-like/">What does C++ Object Layout Look Like?</a></li>
<li><a href="/blog/CPP-Pointer-Adjustment/">C++ Pointer Adjustment</a></li>
<li><a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/derived_class">Derived Class - C++ Reference</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6258559/what-is-the-vtt-for-a-class">What’s VTT for a Class? - Stack Overflow</a></li>
</ul>
<!-- 







https://isocpp.org/wiki/faq/multiple-inheritance#virtual-inheritance-ctors

https://stackoverflow.com/questions/44453057/itanium-c-abi-vtt-content


 -->


<!-- 
## AAAAAAAAAAAAAAAA





The vcall offset is the value that must be added to the `this' 
pointer in the most-derived class in order to obtain the correct
`this' pointer for the function called.



The vbase offset is the value that must be added to the address of
the derived class in order to obtain the address of the virtual 
base.

 -->


<!-- 


## References

* [Itanium C++ ABI - Virtual Table Components and Order](https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable-components)
* [What does C++ Object Layout Look Like?](https://nimrod.blog/posts/what-does-cpp-object-layout-look-like/)






## CCCCCCCCCC

base object destructor of a class T
A function that runs the destructors for non-static data members of T and non-virtual direct base classes of T.

complete object destructor of a class T
A function that, in addition to the actions required of a base object destructor, runs the destructors for the virtual base classes of T.

deleting destructor of a class T
A function that, in addition to the actions required of a complete object destructor, calls the appropriate deallocation function (i.e,. operator delete) for T.



A is a virtual base class
Construction order, assuming B is the most derived class: A -> B -> C -> D
Destruction order, reverse: D -> C -> B -> A


Calling Deleting Destructor D -> Calling Base Object Destructor C (non-virtual base class) -> Calling Complete Object Destructor C (non-virtual base class) -> Calling Base Object Destructor A (virtual base class) -> Call Deallocate D






Virtual base classes
For each distinct base class that is specified virtual, the most derived object contains only one base class subobject of that type, even if the class appears many times in the inheritance hierarchy (as long as it is inherited virtual every time).

struct B { int n; };
class X : public virtual B {};
class Y : virtual public B {};
class Z : public B {};
 
// every object of type AA has one X, one Y, one Z, and two B's:
// one that is the base of Z and one that is shared by X and Y
struct AA : X, Y, Z
{
    AA()
    {
        X::n = 1; // modifies the virtual B subobject's member
        Y::n = 2; // modifies the same virtual B subobject's member
        Z::n = 3; // modifies the non-virtual B subobject's member
 
        std::cout << X::n << Y::n << Z::n << '\n'; // prints 223
    }
};
An example of an inheritance hierarchy with virtual base classes is the iostreams hierarchy of the standard library: std::istream and std::ostream are derived from std::ios using virtual inheritance. std::iostream is derived from both std::istream and std::ostream, so every instance of std::iostream contains a std::ostream subobject, a std::istream subobject, and just one std::ios subobject (and, consequently, one std::ios_base).

All virtual base subobjects are initialized before any non-virtual base subobject, so only the most derived class calls the constructors of the virtual bases in its member initializer list:




## BBBBBBBBBBBB





https://en.wikipedia.org/wiki/Virtual_method_table
https://llvm.org/devmtg/2021-11/slides/2021-RelativeVTablesinC.pdf
https://pabloariasal.github.io/2017/06/10/understanding-virtual-tables/
https://www.vishalchovatiya.com/memory-layout-of-cpp-object/
https://eli.thegreenplace.net/2012/12/17/dumping-a-c-objects-memory-layout-with-clang/


https://nimrod.blog/posts/what-does-cpp-object-layout-look-like/


https://eli.thegreenplace.net/2012/12/17/dumping-a-c-objects-memory-layout-with-clang/


* [What does C++ Object Layout Look Like?](https://nimrod.blog/posts/what-does-cpp-object-layout-look-like/)



https://stackoverflow.com/questions/17960917/why-there-are-two-virtual-destructor-in-the-virtual-table-and-where-is-address-o



https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable


https://en.wikipedia.org/wiki/Virtual_inheritance
 -->
</div><div class="article-licensing box"><div class="licensing-title"><p>C++ Virtual Table</p><p><a href="https://leimao.github.io/blog/CPP-Virtual-Table/">https://leimao.github.io/blog/CPP-Virtual-Table/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Lei Mao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>07-17-2023</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>07-17-2023</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <div><a class="link-muted" rel="tag" href="/tags/CPP/">CPP,</a> </div><div><a class="link-muted" rel="tag" href="/tags/Programming/">Programming,</a> </div><div><a class="link-muted" rel="tag" href="/tags/CPP-Compiler/">CPP Compiler </a> </div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61b5930d440224001908310c&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered has-text-weight-normal">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="SSVSLEH4X85LU"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" href="https://www.buymeacoffee.com/leimao" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/essay/Nike-Vaporfly-3-%E9%9D%9E%E4%B8%93%E4%B8%9A%E8%AF%84%E6%B5%8B/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Nike Vaporfly 3 非专业评测</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/San-Leandro-Marina/"><span class="level-item">San Leandro Marina 徒步</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comment-card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="comment-block"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://leimao.github.io/blog/CPP-Virtual-Table/';
            this.page.identifier = '/blog/CPP-Virtual-Table/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'leimao-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/author_images/Lei-Bio-Medium.jpg" alt="Lei Mao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.30rem;">Lei Mao</p><p class="is-block" style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 0.8em">Artificial Intelligence
Machine Learning
Computer Science
</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Santa Clara, California</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">453</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/leimao" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a> <a class="level-item button is-primary is-rounded" href="https://github.com/sponsors/leimao" target="_blank" rel="noopener"><i class="fas fa-heart"></i>  Sponsor</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/matchaleimao"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/lei-mao/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:dukeleimao@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="G.Scholar" href="https://scholar.google.com/citations?user=R2VUf7YAAAAJ"><i class="ai ai-google-scholar-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#Non-Virtual-Inheritance"><span class="level-left"><span class="level-item">2</span><span class="level-item">Non-Virtual Inheritance</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Example"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Example</span></span></a></li><li><a class="level is-mobile" href="#Class-Hierarchy-and-Virtual-Table"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Class Hierarchy and Virtual Table</span></span></a></li><li><a class="level is-mobile" href="#Class-Memory-Layout"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Class Memory Layout</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Virtual-Inheritance"><span class="level-left"><span class="level-item">3</span><span class="level-item">Virtual Inheritance</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Example-1"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Example</span></span></a></li><li><a class="level is-mobile" href="#Class-Hierarchy-Virtual-Table-and-Virtual-Table-Table"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">Class Hierarchy, Virtual Table, and Virtual Table Table</span></span></a></li><li><a class="level is-mobile" href="#Class-Memory-Layout-1"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Class Memory Layout</span></span></a></li></ul></li><li><a class="level is-mobile" href="#FAQs"><span class="level-left"><span class="level-item">4</span><span class="level-item">FAQs</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Why-There-Are-Two-Destructors-In-the-Virtual-Table"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">Why There Are Two Destructors In the Virtual Table?</span></span></a></li><li><a class="level is-mobile" href="#Why-Constructors-Are-Not-In-the-Virtual-Table"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">Why Constructors Are Not In the Virtual Table?</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Conclusions"><span class="level-left"><span class="level-item">5</span><span class="level-item">Conclusions</span></span></a></li><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">6</span><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="g-ads-x"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3></div><br><center><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDCK3L&amp;placement=leimaogithubio" id="_carbonads_js"></script></center></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2017-2024 Lei Mao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span> <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>