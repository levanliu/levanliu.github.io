<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="twitter:image:src" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>C++ ABI Breaking Change - Lei Mao&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Lei Mao&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lei Mao&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/images/favicon/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="512x512" href="/images/favicon/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="apple-touch-icon" sizes="32x32" href="/images/favicon/favicon-32x32.png"><meta name="description" content="C++ Application Binary Interface Change and Its Consequences"><meta property="og:type" content="blog"><meta property="og:title" content="C++ ABI Breaking Change"><meta property="og:url" content="https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/"><meta property="og:site_name" content="Lei Mao&#039;s Log Book"><meta property="og:description" content="C++ Application Binary Interface Change and Its Consequences"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta property="article:published_time" content="2023-08-07T07:00:00.000Z"><meta property="article:modified_time" content="2023-08-07T07:00:00.000Z"><meta property="article:author" content="Lei Mao"><meta property="article:tag" content="CPP"><meta property="article:tag" content="Programming"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://levanliu.github.io/images/favicon/android-chrome-512x512.png"><meta property="twitter:creator" content="@matchaleimao"><meta property="twitter:site" content="Lei Mao&#039;s Log Book"><meta property="fb:admins" content="dukeleimao"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/"},"headline":"C++ ABI Breaking Change","image":["https://levanliu.github.io/images/favicon/android-chrome-512x512.png"],"datePublished":"2023-08-07T07:00:00.000Z","dateModified":"2023-08-07T07:00:00.000Z","author":{"@type":"Person","name":"Lei Mao"},"publisher":{"@type":"Organization","name":"Lei Mao's Log Book","logo":{"@type":"ImageObject","url":"https://levanliu.github.io/images/favicon/android-chrome-512x512.png"}},"description":"C++ Application Binary Interface Change and Its Consequences"}</script><link rel="canonical" href="https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/"><link rel="alternate" href="/atom.xml" title="Lei Mao&#039;s Log Book" type="application/atom+xml"><link rel="icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=PT+Sans+Narrow:wght@400;700&amp;family=PT+Serif"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-EJY6FXZBCB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-EJY6FXZBCB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script src="//m.servedby-buysellads.com/monetization.custom.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Lei Mao&#039;s Log Book</a><a class="navbar-item" href="/curriculum">Curriculum</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/article">Articles</a><a class="navbar-item" href="/project">Projects</a><a class="navbar-item" href="/publication">Publications</a><a class="navbar-item" href="/reading">Readings</a><a class="navbar-item" href="/life">Life</a><a class="navbar-item" href="/essay">Essay</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/faq">FAQs</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Switch Color Scheme" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitter" href="https://gitter.im/leimao/community"><i class="fab fa-gitter"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-content"><center><div class="bsa-standard" id="carbon-ad-01"></div><script>            (function() {             if (typeof _bsa !== 'undefined' && _bsa) {                 _bsa.init('custom', 'CWYD65QY', 'placement:leimaogithubio-standard', {                     target: '#carbon-ad-01',                     template: `             <a href='##link##' class='native-banner' style='background: ##backgroundColor##' rel='sponsored noopener' target='_blank' title='##company## — ##tagline##'>                 <img class='native-img' width='125' src='##logo##' />                 <div class='native-main'>                     <div class='native-details' style='                             color: ##textColor##;                             border-left: solid 1px ##textColor##;                         '>                         <span class='native-company'>Sponsored by ##company##</span>                         <span class='native-desc'>##description##</span>                     </div>                     <span class='native-cta' style='                             color: ##ctaTextColor##;                             background-color: ##ctaBackgroundColor##;                         '>##callToAction##</span>                 </div>             </a>             `,                 });                 }             })();         </script></center></div></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3" style="font-family: 'PT Sans Narrow', sans-serif">C++ ABI Breaking Change</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left" style="margin-bottom: 0.50rem"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2023-08-07T07:00:00.000Z" title="2023-08-07T07:00:00.000Z">08-07-2023</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2023-08-07T07:00:00.000Z" title="2023-08-07T07:00:00.000Z">08-07-2023</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/blog/">blog</a></span><span class="level-item"><i class="far fa-clock"></i> 15 minutes read (About 2269 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;visits</span></div></div><div class="content" style="margin-top: 1.0rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In computer software, an application binary interface (ABI) is an interface between two binary program modules. Often, one of these modules is a library or operating system facility, and the other is an application or another library that is being used by a user.</p>
<p>An ABI breaking change from the library module update will cause undefined behaviors from the dependent application or library.</p>
<p>In this blog post, I would like to discuss C++ ABI breaking change and how to solve the problems brought by the ABI breaking changes.</p>
<h2 id="ABI-Breaking-Change"><a href="#ABI-Breaking-Change" class="headerlink" title="ABI Breaking Change"></a>ABI Breaking Change</h2><p>In C++, the ABI is almost equivalent as the vtable. We will go through an example to understand what exactly the consequence will be when there is an ABI breaking change and how to fix it. </p>
<h3 id="Repository-Layout"><a href="#Repository-Layout" class="headerlink" title="Repository Layout"></a>Repository Layout</h3><p>The <a target="_blank" rel="noopener" href="https://github.com/leimao/ABI-Change-Demo">ABI Breaking Change Demo</a> is hosted on GitHub. The repository layout is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── application</span><br><span class="line">│   ├── app.cpp</span><br><span class="line">│   ├── app_header_v1.cpp.001l.class</span><br><span class="line">│   └── app_header_v2.cpp.001l.class</span><br><span class="line">├── library_v1</span><br><span class="line">│   ├── liblibrary.so-library.cpp.001l.class</span><br><span class="line">│   ├── library.cpp</span><br><span class="line">│   └── library.h</span><br><span class="line">├── library_v2</span><br><span class="line">│   ├── liblibrary.so-library.cpp.001l.class</span><br><span class="line">│   ├── library.cpp</span><br><span class="line">│   └── library.h</span><br><span class="line">├── LICENSE</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure>


<h3 id="Library-V1"><a href="#Library-V1" class="headerlink" title="Library V1"></a>Library V1</h3><p>This is the first version of the library. We will create <code>Rectangle</code> instances in our application and compute their areas using the overriding <code>Rectangle::area()</code> function.</p>
<figure class="highlight c++"><figcaption><span>library.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> LIBRARY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIBRARY_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> m_width;</span><br><span class="line">    <span class="type">double</span> m_height;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>(<span class="type">double</span> w, <span class="type">double</span> h);</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// LIBRARY_H</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>library.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;library.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Rectangle::<span class="built_in">Rectangle</span>(<span class="type">double</span> w, <span class="type">double</span> h) : <span class="built_in">m_width</span>(w), <span class="built_in">m_height</span>(h) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Rectangle::area</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> m_width * m_height; &#125;</span><br></pre></td></tr></table></figure>

<p>We build the library as a shared library.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build library V1.</span></span><br><span class="line">$ <span class="built_in">cd</span> library_v1</span><br><span class="line">$ g++ -g -fdump-lang-class -shared -fPIC library.cpp -I. -o liblibrary.so</span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>


<figure class="highlight txt"><figcaption><span>liblibrary.so-library.cpp.001l.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Shape</span><br><span class="line">Shape::_ZTV5Shape: 3 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Shape)</span><br><span class="line">16    (int (*)(...))__cxa_pure_virtual</span><br><span class="line"></span><br><span class="line">Class Shape</span><br><span class="line">   size=8 align=8</span><br><span class="line">   base size=8 base align=8</span><br><span class="line">Shape (0x0x7fbff136d420) 0 nearly-empty</span><br><span class="line">    vptr=((&amp; Shape::_ZTV5Shape) + 16)</span><br><span class="line"></span><br><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 3 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::area</span><br><span class="line"></span><br><span class="line">Class Rectangle</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=24 base align=8</span><br><span class="line">Rectangle (0x0x7fbff120e340) 0</span><br><span class="line">    vptr=((&amp; Rectangle::_ZTV9Rectangle) + 16)</span><br><span class="line">Shape (0x0x7fbff136d540) 0 nearly-empty</span><br><span class="line">      primary-for Rectangle (0x0x7fbff120e340)</span><br></pre></td></tr></table></figure>


<h3 id="Library-V2"><a href="#Library-V2" class="headerlink" title="Library V2"></a>Library V2</h3><p>This is the second version of the library, which has an ABI change comparing to the first version. Notice that we got a new additional virtual function <code>perimeter()</code> comparing to the first version, which leads to the ABI change. However, there is no API change and the method <code>Rectangle::area()</code> was not changed, so the user would not have to change their application implementations when they started to use the second version of the library.</p>
<p>As we will later see, depending on the location of the virtual function <code>perimeter()</code>, the ABI change may or may not be ABI breaking.</p>
<figure class="highlight c++"><figcaption><span>library.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> LIBRARY_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LIBRARY_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Adding the new method here breaks the ABI.</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">perimeter</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// Adding the new method here does not break the ABI.</span></span><br><span class="line">    <span class="comment">// virtual double perimeter() const = 0;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> m_width;</span><br><span class="line">    <span class="type">double</span> m_height;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>(<span class="type">double</span> w, <span class="type">double</span> h);</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">perimeter</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// LIBRARY_H</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><figcaption><span>library.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;library.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Rectangle::<span class="built_in">Rectangle</span>(<span class="type">double</span> w, <span class="type">double</span> h) : <span class="built_in">m_width</span>(w), <span class="built_in">m_height</span>(h) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Rectangle::area</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> m_width * m_height; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Rectangle::perimeter</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span> * (m_width + m_height); &#125;</span><br></pre></td></tr></table></figure>

<p>Again, we build the library as a shared library.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build library V2.</span></span><br><span class="line">$ <span class="built_in">cd</span> library_v2</span><br><span class="line">$ g++ -g -fdump-lang-class -shared -fPIC library.cpp -I. -o liblibrary.so</span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><figcaption><span>liblibrary.so-library.cpp.001l.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Shape</span><br><span class="line">Shape::_ZTV5Shape: 4 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Shape)</span><br><span class="line">16    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">24    (int (*)(...))__cxa_pure_virtual</span><br><span class="line"></span><br><span class="line">Class Shape</span><br><span class="line">   size=8 align=8</span><br><span class="line">   base size=8 base align=8</span><br><span class="line">Shape (0x0x7f78cfb6d420) 0 nearly-empty</span><br><span class="line">    vptr=((&amp; Shape::_ZTV5Shape) + 16)</span><br><span class="line"></span><br><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 4 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::perimeter</span><br><span class="line">24    (int (*)(...))Rectangle::area</span><br><span class="line"></span><br><span class="line">Class Rectangle</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=24 base align=8</span><br><span class="line">Rectangle (0x0x7f78cfa0e340) 0</span><br><span class="line">    vptr=((&amp; Rectangle::_ZTV9Rectangle) + 16)</span><br><span class="line">Shape (0x0x7f78cfb6d540) 0 nearly-empty</span><br><span class="line">      primary-for Rectangle (0x0x7f78cfa0e340)</span><br></pre></td></tr></table></figure>


<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><p>This is the application implementation from user that uses the library we created. Basically we will create a <code>Rectangle</code> instance and compute the area using the overriding <code>Rectangle::area</code> function.</p>
<figure class="highlight c++"><figcaption><span>app.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;library.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> width&#123;<span class="number">5.0</span>&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> height&#123;<span class="number">3.0</span>&#125;;</span><br><span class="line">    std::unique_ptr&lt;Shape&gt; rect&#123;std::<span class="built_in">make_unique</span>&lt;Rectangle&gt;(width, height)&#125;;</span><br><span class="line">    <span class="type">double</span> <span class="type">const</span> area&#123;rect-&gt;<span class="built_in">area</span>()&#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Area: &quot;</span> &lt;&lt; area &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">if</span> (area != width * height)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::runtime_error&#123;<span class="string">&quot;Area is not correct.&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We will separately build the application using the header files from different versions of the libraries.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build application.</span></span><br><span class="line">$ <span class="built_in">cd</span> application</span><br><span class="line"><span class="comment"># Build application using the header from library V1.</span></span><br><span class="line">$ g++ -g -fdump-lang-class -o app_header_v1.o -c app.cpp -I../library_v1</span><br><span class="line"><span class="comment"># Build application using the header from library V2.</span></span><br><span class="line">$ g++ -g -fdump-lang-class -o app_header_v2.o -c app.cpp -I../library_v2</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><figcaption><span>app_header_v1.cpp.001l.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Shape</span><br><span class="line">Shape::_ZTV5Shape: 3 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Shape)</span><br><span class="line">16    (int (*)(...))__cxa_pure_virtual</span><br><span class="line"></span><br><span class="line">Class Shape</span><br><span class="line">   size=8 align=8</span><br><span class="line">   base size=8 base align=8</span><br><span class="line">Shape (0x0x7fcdee1d7c00) 0 nearly-empty</span><br><span class="line">    vptr=((&amp; Shape::_ZTV5Shape) + 16)</span><br><span class="line"></span><br><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 3 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::area</span><br><span class="line"></span><br><span class="line">Class Rectangle</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=24 base align=8</span><br><span class="line">Rectangle (0x0x7fcdedd015b0) 0</span><br><span class="line">    vptr=((&amp; Rectangle::_ZTV9Rectangle) + 16)</span><br><span class="line">Shape (0x0x7fcdee1d7d20) 0 nearly-empty</span><br><span class="line">      primary-for Rectangle (0x0x7fcdedd015b0)</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><figcaption><span>app_header_v2.cpp.001l.class</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Shape</span><br><span class="line">Shape::_ZTV5Shape: 4 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Shape)</span><br><span class="line">16    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">24    (int (*)(...))__cxa_pure_virtual</span><br><span class="line"></span><br><span class="line">Class Shape</span><br><span class="line">   size=8 align=8</span><br><span class="line">   base size=8 base align=8</span><br><span class="line">Shape (0x0x7fe8be9d8c00) 0 nearly-empty</span><br><span class="line">    vptr=((&amp; Shape::_ZTV5Shape) + 16)</span><br><span class="line"></span><br><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 4 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::perimeter</span><br><span class="line">24    (int (*)(...))Rectangle::area</span><br><span class="line"></span><br><span class="line">Class Rectangle</span><br><span class="line">   size=24 align=8</span><br><span class="line">   base size=24 base align=8</span><br><span class="line">Rectangle (0x0x7fe8be6215b0) 0</span><br><span class="line">    vptr=((&amp; Rectangle::_ZTV9Rectangle) + 16)</span><br><span class="line">Shape (0x0x7fe8be9d8d20) 0 nearly-empty</span><br><span class="line">      primary-for Rectangle (0x0x7fe8be6215b0)</span><br></pre></td></tr></table></figure>


<p>Because we have two libraries, we will get two application object files, <code>app_header_v1.o</code> and <code>app_header_v2.o</code>.</p>
<p>To link the application object files to the libraries, each application object file has two options, library V1 and V2.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Link application to libraries.</span></span><br><span class="line"><span class="comment"># There are no linker errors, suggesting that Rectangle::area() that is</span></span><br><span class="line"><span class="comment"># used in the app.cpp have been successfully found.</span></span><br><span class="line"><span class="comment"># Link application using the header from library V1 correctly with library V1.</span></span><br><span class="line">g++ -o app_header_v1_library_v1.app app_header_v1.o -L../library_v1 -llibrary</span><br><span class="line"><span class="comment"># Link application using the header from library V2 correctly with library V2.</span></span><br><span class="line">g++ -o app_header_v2_library_v2.app app_header_v2.o -L../library_v2 -llibrary</span><br><span class="line"><span class="comment"># Link application using the header from library V1 correctly with library V2.</span></span><br><span class="line"><span class="comment"># ABI breaking change (vtable conflict)</span></span><br><span class="line">g++ -o app_header_v1_library_v2.app app_header_v1.o -L../library_v2 -llibrary</span><br><span class="line"><span class="comment"># Link application using the header from library V2 correctly with library V1.</span></span><br><span class="line"><span class="comment"># ABI breaking change (vtable conflict)</span></span><br><span class="line">g++ -o app_header_v2_library_v1.app app_header_v2.o -L../library_v1 -llibrary</span><br></pre></td></tr></table></figure>

<p>Taken together, we will get four application executable files, including <code>app_header_v1_library_v1.app</code>, <code>app_header_v2_library_v2.app</code>, <code>app_header_v1_library_v2.app</code>, and <code>app_header_v2_library_v1.app</code>.</p>
<p>After running the four application executable files, we found that only <code>app_header_v1_library_v1.app</code> and <code>app_header_v2_library_v2.app</code> behaved as expected whereas <code>app_header_v1_library_v2.app</code> and <code>app_header_v2_library_v1.app</code> did not have the expected behaviors.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ LD_LIBRARY_PATH=../library_v1 ./app_header_v1_library_v1.app</span><br><span class="line">Area: 15</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ LD_LIBRARY_PATH=../library_v1 ./app_header_v2_library_v1.app</span><br><span class="line">Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ LD_LIBRARY_PATH=../library_v2 ./app_header_v2_library_v2.app</span><br><span class="line">Area: 15</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ LD_LIBRARY_PATH=../library_v2 ./app_header_v1_library_v2.app</span><br><span class="line">Area: 16</span><br><span class="line">terminate called after throwing an instance of <span class="string">&#x27;std::runtime_error&#x27;</span></span><br><span class="line">  what():  Area is not correct.</span><br><span class="line">Aborted (core dumped)</span><br></pre></td></tr></table></figure>

<p>This is because the library V2 introduced an ABI breaking change to the library V1. Therefore, the application object file compiled with the header file from the library V1 becomes incompatible with the library V2, and the application object file compiled with the header file from the library V2 becomes incompatible with the library V1.</p>
<h3 id="What’s-Happened"><a href="#What’s-Happened" class="headerlink" title="What’s Happened?"></a>What’s Happened?</h3><p>The vtable for the <code>Rectangle</code> from the library V1 and the application executable object file <code>app_header_v1.o</code> compiled with the header file from the library V1 is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 3 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::area</span><br></pre></td></tr></table></figure>

<p>The vtable for the <code>Rectangle</code> from the library V2 and the application executable object file <code>app_header_v2.o</code> compiled with the header file from the library V2 is as follows.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Rectangle</span><br><span class="line">Rectangle::_ZTV9Rectangle: 4 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI9Rectangle)</span><br><span class="line">16    (int (*)(...))Rectangle::perimeter</span><br><span class="line">24    (int (*)(...))Rectangle::area</span><br></pre></td></tr></table></figure>

<p>By the implementation of my GCC compiler, after compiling the application executable file <code>app_header_v1.o</code> with the library V1 header file, the <code>rect-&gt;area()</code> from the <code>app_header_v1.o</code> has to invoke the function <code>(int (*)(...))Rectangle::area</code>, which is the 3rd entry <code>((&amp; Rectangle::_ZTV9Rectangle) + 16)</code> in the vtable static array, via the vtable pointer. However, if the vtable static array, provided by the library (which is compiler implementation dependent), is from the library V2, the 3rd entry in the static array <code>((&amp; Rectangle::_ZTV9Rectangle) + 16)</code> actually becomes the function <code>(int (*)(...))Rectangle::perimeter</code>. That’s why, the <code>rect-&gt;area()</code> from the <code>app_header_v1_library_v2.app</code> computed the <code>perimeter</code> instead of <code>area</code>.</p>
<p>Similarly, after compiling the application executable file <code>app_header_v2.o</code> with the library V2 header file, the <code>rect-&gt;area()</code> from the <code>app_header_v2.o</code> has to invoke the function <code>(int (*)(...))Rectangle::area</code>, which is the 4th entry <code>((&amp; Rectangle::_ZTV9Rectangle) + 24)</code> in the vtable static array, via the vtable pointer. However, if the vtable static array, provided by the library (which is compiler implementation dependent), is from the library V1, the 4th entry is actually out of the boundary of the vtable static library. That’s why, the <code>rect-&gt;area()</code> from the <code>app_header_v2_library_v1.app</code> results in a segmentation fault.</p>
<p>Fundamentally, this ABI breaking change is due to the location of the virtual function <code>area</code> got shifted after a new virtual function <code>perimeter</code> got added.</p>
<h3 id="Avoid-ABI-Breaking-Change"><a href="#Avoid-ABI-Breaking-Change" class="headerlink" title="Avoid ABI Breaking Change"></a>Avoid ABI Breaking Change</h3><p>To avoid ABI breaking change, in our case, the library developer can insert the new virtual function <code>perimeter</code> after the existing virtual function <code>area</code>. Then the location of the virtual function <code>area</code> will remain the same in the library V2. The <code>app_header_v1_library_v2.app</code> and <code>app_header_v2_library_v1.app</code> will also run fine as expected.</p>
<p>From the user’s perspective, if we can, whenever we get an upgraded version of the library, we should recompile the dependent application or library and always run <code>app_header_v1_library_v1.app</code> or <code>app_header_v2_library_v2.app</code> to ensure any ABI incompatibility has been eliminated.</p>
<h2 id="Real-World-Implications"><a href="#Real-World-Implications" class="headerlink" title="Real-World Implications"></a>Real-World Implications</h2><p>Fundamentally, an ABI breaking change is due to the vtable used for the updated library becomes incompatible with the vtable used for the dependent library or application. This has a real-world implications.</p>
<p>Suppose there is a library, say the OpenCV library <code>libopencv-dev</code> which depends on a third-party library <code>libgtk-3-dev</code>. In the <code>libopencv-dev0.1</code> release, it was built against <code>libgtk-3-dev0.2</code>. When the users install <code>libopencv-dev0.1</code> on Linux, they will also have to install <code>libgtk-3-dev0.2</code>. This is fine.</p>
<p>Later, when the user upgraded their systems, <code>libgtk-3-dev</code> got upgraded to <code>libgtk-3-dev0.3</code> but <code>libopencv-dev</code> remained to be <code>libopencv-dev0.1</code>. If there is no ABI breaking change, the user can still use <code>libopencv-dev0.1</code> normally. However, if there is an ABI breaking change, <code>libopencv-dev0.1</code> cannot just be used normally anymore. The user would have to recompile <code>libopencv-dev</code> using the upgraded library <code>libgtk-3-dev0.3</code> and it’s sometimes difficult and time-consuming to do. In addition, as we have seen in our example, sometimes the ABI breaking change can even silently change the behavior of programs without crashing them. That’s why the software developers should not break ABI unless it’s absolutely inevitable to make the user’s life easier.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>Ideally, the best practice for the user is always rebuilding the application whenever the library gets updated so that any ABI change will not affect the application behavior. The best practice for the library developer is avoiding ABI breaking changes as many as possible.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/ABI-Change-Demo">ABI Breaking Change Demo - GitHub</a></li>
<li><a href="/blog/CPP-Virtual-Table/">C++ Virtual Table</a></li>
<li><a href="/blog/CPP-Pointer-Adjustment/">C++ Pointer Adjustment</a></li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Application_binary_interface">Application Binary Interface</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>C++ ABI Breaking Change</p><p><a href="https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/">https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Lei Mao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>08-07-2023</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>08-07-2023</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <div><a class="link-muted" rel="tag" href="/tags/CPP/">CPP,</a> </div><div><a class="link-muted" rel="tag" href="/tags/Programming/">Programming </a> </div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61b5930d440224001908310c&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered has-text-weight-normal">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="SSVSLEH4X85LU"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" href="https://www.buymeacoffee.com/leimao" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/essay/Gundam-SEED-2024%E5%89%A7%E5%9C%BA%E7%89%88-PV2/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">高达 SEED 2024 剧场版 PV2</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/essay/%E8%80%81%E9%AB%98%E4%B8%8E%E5%B0%8F%E8%8C%89%E6%B6%89%E5%AB%8C%E6%8A%84%E8%A2%AD/"><span class="level-item">老高与小茉涉嫌抄袭</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comment-card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="comment-block"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://levanliu.github.io/blog/CPP-ABI-Breaking-Change/';
            this.page.identifier = '/blog/CPP-ABI-Breaking-Change/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'leimao-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/author_images/Lei-Bio-Medium.jpg" alt="Lei Mao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.30rem;">Lei Mao</p><p class="is-block" style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 0.8em">Artificial Intelligence
Machine Learning
Computer Science
</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Santa Clara, California</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">453</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/leimao" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a> <a class="level-item button is-primary is-rounded" href="https://github.com/sponsors/leimao" target="_blank" rel="noopener"><i class="fas fa-heart"></i>  Sponsor</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/matchaleimao"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/lei-mao/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:dukeleimao@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="G.Scholar" href="https://scholar.google.com/citations?user=R2VUf7YAAAAJ"><i class="ai ai-google-scholar-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#ABI-Breaking-Change"><span class="level-left"><span class="level-item">2</span><span class="level-item">ABI Breaking Change</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Repository-Layout"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Repository Layout</span></span></a></li><li><a class="level is-mobile" href="#Library-V1"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Library V1</span></span></a></li><li><a class="level is-mobile" href="#Library-V2"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">Library V2</span></span></a></li><li><a class="level is-mobile" href="#Application"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">Application</span></span></a></li><li><a class="level is-mobile" href="#What’s-Happened"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">What’s Happened?</span></span></a></li><li><a class="level is-mobile" href="#Avoid-ABI-Breaking-Change"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">Avoid ABI Breaking Change</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Real-World-Implications"><span class="level-left"><span class="level-item">3</span><span class="level-item">Real-World Implications</span></span></a></li><li><a class="level is-mobile" href="#Conclusions"><span class="level-left"><span class="level-item">4</span><span class="level-item">Conclusions</span></span></a></li><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">5</span><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="g-ads-x"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3></div><br><center><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDCK3L&amp;placement=leimaogithubio" id="_carbonads_js"></script></center></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2017-2024 Lei Mao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span> <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>