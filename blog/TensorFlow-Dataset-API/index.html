<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>Guide to TensorFlow Dataset API - Lei Mao&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Lei Mao&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lei Mao&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/images/favicon/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="512x512" href="/images/favicon/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="apple-touch-icon" sizes="32x32" href="/images/favicon/favicon-32x32.png"><meta name="description" content="Harness TensorFlow Dataset API for Real Applications"><meta property="og:type" content="blog"><meta property="og:title" content="Guide to TensorFlow Dataset API"><meta property="og:url" content="https://leimao.github.io/blog/TensorFlow-Dataset-API/"><meta property="og:site_name" content="Lei Mao&#039;s Log Book"><meta property="og:description" content="Harness TensorFlow Dataset API for Real Applications"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="article:published_time" content="2018-08-11T07:00:00.000Z"><meta property="article:modified_time" content="2018-08-11T07:00:00.000Z"><meta property="article:author" content="Lei Mao"><meta property="article:tag" content="TensorFlow"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="twitter:creator" content="@matchaleimao"><meta property="twitter:site" content="Lei Mao&#039;s Log Book"><meta property="fb:admins" content="dukeleimao"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://leimao.github.io/blog/TensorFlow-Dataset-API/"},"headline":"Guide to TensorFlow Dataset API","image":["https://leimao.github.io/images/favicon/android-chrome-512x512.png"],"datePublished":"2018-08-11T07:00:00.000Z","dateModified":"2018-08-11T07:00:00.000Z","author":{"@type":"Person","name":"Lei Mao"},"publisher":{"@type":"Organization","name":"Lei Mao's Log Book","logo":{"@type":"ImageObject","url":"https://leimao.github.io/images/favicon/android-chrome-512x512.png"}},"description":"Harness TensorFlow Dataset API for Real Applications"}</script><link rel="canonical" href="https://leimao.github.io/blog/TensorFlow-Dataset-API/"><link rel="alternate" href="/atom.xml" title="Lei Mao&#039;s Log Book" type="application/atom+xml"><link rel="icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=PT+Sans+Narrow:wght@400;700&amp;family=PT+Serif"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-EJY6FXZBCB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-EJY6FXZBCB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script src="//m.servedby-buysellads.com/monetization.custom.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Lei Mao&#039;s Log Book</a><a class="navbar-item" href="/curriculum">Curriculum</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/article">Articles</a><a class="navbar-item" href="/project">Projects</a><a class="navbar-item" href="/publication">Publications</a><a class="navbar-item" href="/reading">Readings</a><a class="navbar-item" href="/life">Life</a><a class="navbar-item" href="/essay">Essay</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/faq">FAQs</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Switch Color Scheme" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitter" href="https://gitter.im/leimao/community"><i class="fab fa-gitter"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-content"><center><div class="bsa-standard" id="carbon-ad-01"></div><script>            (function() {             if (typeof _bsa !== 'undefined' && _bsa) {                 _bsa.init('custom', 'CWYD65QY', 'placement:leimaogithubio-standard', {                     target: '#carbon-ad-01',                     template: `             <a href='##link##' class='native-banner' style='background: ##backgroundColor##' rel='sponsored noopener' target='_blank' title='##company## — ##tagline##'>                 <img class='native-img' width='125' src='##logo##' />                 <div class='native-main'>                     <div class='native-details' style='                             color: ##textColor##;                             border-left: solid 1px ##textColor##;                         '>                         <span class='native-company'>Sponsored by ##company##</span>                         <span class='native-desc'>##description##</span>                     </div>                     <span class='native-cta' style='                             color: ##ctaTextColor##;                             background-color: ##ctaBackgroundColor##;                         '>##callToAction##</span>                 </div>             </a>             `,                 });                 }             })();         </script></center></div></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3" style="font-family: 'PT Sans Narrow', sans-serif">Guide to TensorFlow Dataset API</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left" style="margin-bottom: 0.50rem"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2018-08-11T07:00:00.000Z" title="2018-08-11T07:00:00.000Z">08-11-2018</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2018-08-11T07:00:00.000Z" title="2018-08-11T07:00:00.000Z">08-11-2018</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/blog/">blog</a></span><span class="level-item"><i class="far fa-clock"></i> 17 minutes read (About 2481 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;visits</span></div></div><div class="content" style="margin-top: 1.0rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>I have been using TensorFlow since its first release (version 0.1) in 2015. So some of my coding habits for the earlier versions have been kept until now. One of the habits is that I always use <code>placeholder</code> and <code>feed_dict</code> to feed data, including training data, validation data, and test data, into the TensorFlow graph for computation. <code>placeholder</code> and <code>feed_dict</code> make your program super flexible. When you have newly collected data, feeding data using <code>feed_dict</code> will never damage the pre-built TensorFlow graph. When you want to change the dropout rate to 0 during test time, or adjust the learning rate during training time, <code>feed_dict</code> is always the best choice to make your program flexible.</p>
<p>Because the datasets of some of my research projects become larger, I started to be concerned about the data loading and preprocessing efficiencies, as it may become the “bottleneck” of the training process if not being handled properly. For large datasets, it is not feasible to read all the data into memory and load the data to the program from memory (You may do it on your supercomputer, but others will probably not be able to run your program on their own desktops). So what people usually do is to read data from disk and do all the data preprocessing on the fly. So to make this portion of code looking neat, I have written <code>Dataset</code> and <code>Iterator</code> classes for some of my projects. However, they are not generalizable, meaning that if you want to use the <code>Dataset</code> and <code>Iterator</code> from one project for another project, it usually has to be modified significantly. In addition, my <code>Dataset</code> and <code>Iterator</code> was not written in multi-thread fashion, making me concerned about the loading and preprocessing efficiencies.</p>
<p>As TensorFlow updates, I started to be aware that there are official <code>Dataset</code> and <code>Iterator</code> classes in TensorFlow, which allows users to make use of their internal optimization for loading and preprocessing data. According to the <a target="_blank" rel="noopener" href="https://www.tensorflow.org/performance/datasets_performance">TensorFlow</a> official documentation, using their <code>Iterator</code> should be asymptotically faster than an ordinary single-thread <code>Iterator</code>. However, in my preliminary tests, I found the TensorFlow <code>Iterator</code> was significantly slower than a manual single-thread <code>Iterator</code> in some cases, probably due to its heavy overhead running time.</p>
<h2 id="TensorFlow-Dataset-API-Usages"><a href="#TensorFlow-Dataset-API-Usages" class="headerlink" title="TensorFlow Dataset API Usages"></a>TensorFlow Dataset API Usages</h2><p>Frankly, I think it is not easy to learn the TensorFlow Dataset APIs, because there are many different ways to use the APIs and those ways have slightly different effects, which means that they have to be used for different purposes. The official <a target="_blank" rel="noopener" href="https://www.tensorflow.org/guide/datasets">guide</a> provided some toy examples of how to use TensorFlow Dataset APIs in different ways. But it is really hard for users to understand why they have to code in that way for each step, not even mention how to choose appropriate ways to code for different purposes.</p>
<p>For most of the ways of using TensorFlow Dataset APIs, they will work well for most of your research projects because usually the dataset of your research project is fixed. You can create <code>Dataset</code> and <code>Iterator</code> instances for your fixed training, validation, and test dataset independently. Your TensorFlow program does not have to be written in a fashion that allows new data neither. However, in practice, we always trained our model for testing new data, and our TensorFlow program has to allow new data streams if it is going to be a real application. In this case, we need to carefully design our program to allow the new data stream using TensorFlow official <code>Iterator</code>.</p>
<p>The toy dataset on TensorFlow official <a target="_blank" rel="noopener" href="https://www.tensorflow.org/guide/datasets">guide</a> for TensorFlow Dataset API usage is trivial. Here I will use MNIST dataset as a concrete example. TensorFlow <code>Dataset</code> and <code>Iterator</code> instances are the two compulsory components of the API.</p>
<h3 id="Dataset-Instance"><a href="#Dataset-Instance" class="headerlink" title="Dataset Instance"></a>Dataset Instance</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Preprocessor</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_classes</span>):</span><br><span class="line"></span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">self, images, labels</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Data preprocess procedures</span></span><br><span class="line"><span class="string">        images: tensor format, dtype = tf.uint8</span></span><br><span class="line"><span class="string">        labels: tensor format, dtype = tf.uint8</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># Change dtype from uint to float</span></span><br><span class="line">        images = tf.cast(images, tf.float32)</span><br><span class="line">        <span class="comment"># Scale images</span></span><br><span class="line">        images = images / <span class="number">255</span></span><br><span class="line">        <span class="comment"># One-hot encoding</span></span><br><span class="line">        labels = tf.one_hot(indices = labels, depth = self.num_classes)</span><br><span class="line">        <span class="comment"># Change dtype from uint to float</span></span><br><span class="line">        labels = tf.cast(labels, tf.float32)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> images, labels</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dataset_generation</span>(<span class="params">images, labels, preprocess, buffer_size = <span class="number">100000</span>, batch_size = <span class="number">16</span>, repeat = <span class="literal">False</span>, shuffle = <span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Generate tensorflow dataset object</span></span><br><span class="line"><span class="string">    images: numpy array format</span></span><br><span class="line"><span class="string">    labels: numpy array format</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    dataset = tf.data.Dataset.from_tensor_slices((images, labels))</span><br><span class="line">    dataset = dataset.<span class="built_in">map</span>(preprocess)</span><br><span class="line">    <span class="keyword">if</span> repeat:</span><br><span class="line">        dataset = dataset.repeat()</span><br><span class="line">    <span class="keyword">if</span> shuffle:</span><br><span class="line">        dataset = dataset.shuffle(buffer_size = buffer_size)</span><br><span class="line">    dataset = dataset.batch(batch_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create TensorFlow dataset preprocessing unit</span></span><br><span class="line">preprocessor = Preprocessor(num_classes = num_classes)</span><br><span class="line"><span class="comment"># Create TensorFlow Dataset instance</span></span><br><span class="line">train_dataset = dataset_generation(images = train_images, labels = train_labels, preprocess = preprocessor.preprocess, batch_size = <span class="number">16</span>, repeat = <span class="literal">True</span>, shuffle = <span class="literal">True</span>)</span><br><span class="line">test_dataset = dataset_generation(images = test_images, labels = test_labels, preprocess = preprocessor.preprocess, batch_size = <span class="number">16</span>, repeat = <span class="literal">False</span>, shuffle = <span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>To generate TensorFlow <code>Dataset</code> instance, usually four things have to be set.</p>
<p><strong>Iterable Numpy Array Format Dataset</strong></p>
<p>For small datasets, it could be just the numpy array of the whole dataset. For large datasets, it could be the filenames or filepath of the data stored in the hard drive.</p>
<p><strong>Data Preprocess</strong></p>
<p>The dataset preprocessing was done using <code>map</code>. This is where the preprocessing and loading efficiencies happen, since the <code>map</code> function allows the procedures to run in parallel.</p>
<p><strong>Shuffle</strong></p>
<p>Usually, we could just shuffle the dataset beforehand without using the built-in shuffle function. If you use shuffle for dataset, it will shuffle the dataset every time you start a new <code>Iterator</code> instance and it is usually slow in practice.</p>
<p><strong>Batch Size</strong></p>
<p>Designate the batch size for your dataset.</p>
<h3 id="Iterator-Instance"><a href="#Iterator-Instance" class="headerlink" title="Iterator Instance"></a>Iterator Instance</h3><p>According to the official TensorFlow <a target="_blank" rel="noopener" href="https://www.tensorflow.org/guide/datasets">guide</a>, there are four types of <code>Iterator</code>: one-shot, initializable, reinitializable, and feedable. Personally, I think reinitializable and feedable <code>Iterator</code>s are the most useful in practice. I also integrate the <code>Iterator</code> instances into training class because I usually prefer to write TensorFlow code in an object-oriented fashion.</p>
<p>A typical object-oriented TensorFlow code with the official TensorFlow <code>Iterator</code> reinitializable instance looks like this.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CNN</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dataset_output_types, dataset_output_shapes, num_classes = <span class="number">10</span>, batch_size = <span class="number">16</span>, dropout = <span class="number">0.5</span>, learning_rate = <span class="number">0.001</span></span>):</span><br><span class="line"></span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.dropout = dropout</span><br><span class="line">        self.learning_rate = learning_rate</span><br><span class="line"></span><br><span class="line">        <span class="comment"># TensorFlow Iterator instance</span></span><br><span class="line">        self.iterator = tf.data.Iterator.from_structure(output_types = dataset_output_types, output_shapes = dataset_output_shapes)</span><br><span class="line">        self.images, self.labels = self.iterator.get_next()</span><br><span class="line"></span><br><span class="line">        self.model_initializer()</span><br><span class="line">        self.optimizer_initializer()</span><br><span class="line"></span><br><span class="line">        self.saver = tf.train.Saver()</span><br><span class="line">        self.sess = tf.Session()</span><br><span class="line">        self.sess.run(tf.global_variables_initializer())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">model_initializer</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.outputs_train = conv_net(x = self.images, num_classes = self.num_classes, dropout = self.dropout, reuse = <span class="literal">False</span>, is_training = <span class="literal">True</span>)</span><br><span class="line">        self.outputs_test = conv_net(x = self.images, num_classes = self.num_classes, dropout = <span class="number">0</span>, reuse = <span class="literal">True</span>, is_training = <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        correct_pred = tf.equal(tf.argmax(self.outputs_test, <span class="number">1</span>), tf.argmax(self.labels, <span class="number">1</span>))</span><br><span class="line">        self.accuracy = tf.reduce_mean(tf.cast(correct_pred, tf.float32))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">optimizer_initializer</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        self.loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits_v2(logits = self.outputs_train, labels = self.labels))</span><br><span class="line">        self.optimizer = tf.train.AdamOptimizer(learning_rate = self.learning_rate).minimize(self.loss)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">self, train_dataset, num_iterations</span>):</span><br><span class="line"></span><br><span class="line">        train_init_operator = self.iterator.make_initializer(train_dataset)</span><br><span class="line">        self.sess.run(train_init_operator)</span><br><span class="line"></span><br><span class="line">        train_accuracies = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iterations):</span><br><span class="line">            _, train_accuracy = self.sess.run([self.optimizer, self.accuracy])</span><br><span class="line">            train_accuracies.append(train_accuracy)</span><br><span class="line"></span><br><span class="line">        train_accuracy_mean = np.mean(train_accuracies)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> train_accuracy_mean</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">self, test_dataset, num_iterations</span>):</span><br><span class="line"></span><br><span class="line">        test_init_operator = self.iterator.make_initializer(test_dataset)</span><br><span class="line">        self.sess.run(test_init_operator)</span><br><span class="line"></span><br><span class="line">        test_accuracies = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_iterations):</span><br><span class="line">            test_accuracy = self.sess.run(self.accuracy)</span><br><span class="line">            test_accuracies.append(test_accuracy)</span><br><span class="line"></span><br><span class="line">        test_accuracy_mean = np.mean(test_accuracies)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> test_accuracy_mean</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, directory, filename</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">            os.makedirs(directory)</span><br><span class="line">        self.saver.save(self.sess, os.path.join(directory, filename))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> os.path.join(directory, filename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">self, filepath</span>):</span><br><span class="line"></span><br><span class="line">        self.saver.restore(self.sess, filepath)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We use <code>tf.data.Iterator</code> to create <code>Iterator</code> instance, and <code>iterator.get_next()</code> as the inputs for the TensorFlow graph. Each time we want to switch dataset, we have to reinitialize the <code>Iterator</code> using the following way.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_init_operator = self.iterator.make_initializer(train_dataset)</span><br><span class="line">self.sess.run(train_init_operator)</span><br></pre></td></tr></table></figure>

<p>Therefore, even if there is a new data stream coming, we just have to create a <code>Dataset</code> instance outside the main TensorFlow graph, and pass the <code>Dataset</code> instance into the main TensorFlow graph for <code>Iterator</code> initialization.</p>
<h2 id="TensorFlow-Dataset-API-Drawbacks"><a href="#TensorFlow-Dataset-API-Drawbacks" class="headerlink" title="TensorFlow Dataset API Drawbacks"></a>TensorFlow Dataset API Drawbacks</h2><p>I tested training MNIST digit classifier on an NVIDIA TitanX GPU using Numpy format MNIST dataset with manual single-thread data loading and preprocessing instance, TensorFlow reinitializable <code>Iterator</code> instance, and TensorFlow feedable <code>Iterator</code> instance. I found TensorFlow reinitializable <code>Iterator</code> and TensorFlow feedable <code>Iterator</code> are comparable, but they are not significantly faster than manual single-thread data loading and preprocessing instance. </p>
<h3 id="Manual-Instance"><a href="#Manual-Instance" class="headerlink" title="Manual Instance"></a>Manual Instance</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.51 | Test Accuracy: 0.70</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.87 | Test Accuracy: 0.82</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.91 | Test Accuracy: 0.88</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.94 | Test Accuracy: 0.89</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.97 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 005 | Train Accuracy: 0.99 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 006 | Train Accuracy: 1.00 | Test Accuracy: 0.90</span><br><span class="line">Epoch: 007 | Train Accuracy: 1.00 | Test Accuracy: 0.90</span><br><span class="line">Epoch: 008 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 010 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Time Elapsed: 00:00:05</span><br></pre></td></tr></table></figure>

<h3 id="TensorFlow-Reinitializable-Iterator-Instance"><a href="#TensorFlow-Reinitializable-Iterator-Instance" class="headerlink" title="TensorFlow Reinitializable Iterator Instance"></a>TensorFlow Reinitializable Iterator Instance</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.49 | Test Accuracy: 0.62</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.88 | Test Accuracy: 0.83</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.94 | Test Accuracy: 0.86</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.95 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.99 | Test Accuracy: 0.89</span><br><span class="line">Epoch: 005 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 006 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 007 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 008 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.90</span><br><span class="line">Epoch: 010 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Time Elapsed: 00:00:05</span><br></pre></td></tr></table></figure>

<h4 id="TensorFlow-Feedable-Iterator-Instance"><a href="#TensorFlow-Feedable-Iterator-Instance" class="headerlink" title="TensorFlow Feedable Iterator Instance"></a>TensorFlow Feedable Iterator Instance</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.49 | Test Accuracy: 0.70</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.87 | Test Accuracy: 0.80</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.92 | Test Accuracy: 0.85</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.95 | Test Accuracy: 0.90</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.97 | Test Accuracy: 0.89</span><br><span class="line">Epoch: 005 | Train Accuracy: 0.99 | Test Accuracy: 0.89</span><br><span class="line">Epoch: 006 | Train Accuracy: 0.99 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 007 | Train Accuracy: 1.00 | Test Accuracy: 0.88</span><br><span class="line">Epoch: 008 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 010 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.92</span><br><span class="line">Time Elapsed: 00:00:05</span><br></pre></td></tr></table></figure>

<p>I later tried to increase the complexity of the preprocessing function but found there is only a very slight improvement.</p>
<p>Because for some datasets, we would not load the whole dataset into memory as a Numpy array but read batches from hard drive using their filepaths. I tested loading MNIST dataset from the hard drive during training. The test result is surprising, the TensorFlow <code>Iterator</code> intances are actually much slower than single-thread manual data loading.</p>
<h3 id="Manual-Instance-1"><a href="#Manual-Instance-1" class="headerlink" title="Manual Instance"></a>Manual Instance</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.40 | Test Accuracy: 0.65</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.77 | Test Accuracy: 0.82</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.90 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.94 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.96 | Test Accuracy: 0.95</span><br><span class="line">Epoch: 005 | Train Accuracy: 1.00 | Test Accuracy: 0.95</span><br><span class="line">Epoch: 006 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 007 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 008 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 010 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.95</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Time Elapsed: 00:00:05</span><br></pre></td></tr></table></figure>

<h3 id="TensorFlow-Reinitializable-Iterator-Instance-1"><a href="#TensorFlow-Reinitializable-Iterator-Instance-1" class="headerlink" title="TensorFlow Reinitializable Iterator Instance"></a>TensorFlow Reinitializable Iterator Instance</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.42 | Test Accuracy: 0.68</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.78 | Test Accuracy: 0.79</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.89 | Test Accuracy: 0.90</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.93 | Test Accuracy: 0.89</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.98 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 005 | Train Accuracy: 0.98 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 006 | Train Accuracy: 0.99 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 007 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 008 | Train Accuracy: 0.99 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 010 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.95</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.95</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Time Elapsed: 00:00:12</span><br></pre></td></tr></table></figure>

<h3 id="TensorFlow-Feedable-Iterator-Instance-1"><a href="#TensorFlow-Feedable-Iterator-Instance-1" class="headerlink" title="TensorFlow Feedable Iterator Instance"></a>TensorFlow Feedable Iterator Instance</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Epoch: 000 | Train Accuracy: 0.38 | Test Accuracy: 0.62</span><br><span class="line">Epoch: 001 | Train Accuracy: 0.78 | Test Accuracy: 0.77</span><br><span class="line">Epoch: 002 | Train Accuracy: 0.88 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 003 | Train Accuracy: 0.92 | Test Accuracy: 0.91</span><br><span class="line">Epoch: 004 | Train Accuracy: 0.97 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 005 | Train Accuracy: 0.99 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 006 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 007 | Train Accuracy: 0.98 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 008 | Train Accuracy: 0.98 | Test Accuracy: 0.92</span><br><span class="line">Epoch: 009 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 010 | Train Accuracy: 0.99 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 011 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 012 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 013 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 014 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 015 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 016 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 017 | Train Accuracy: 1.00 | Test Accuracy: 0.93</span><br><span class="line">Epoch: 018 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Epoch: 019 | Train Accuracy: 1.00 | Test Accuracy: 0.94</span><br><span class="line">Time Elapsed: 00:00:12</span><br></pre></td></tr></table></figure>

<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>Using TensorFlow <code>Iterator</code> is not necessarily faster than the self-implemented single-thread <code>Iterator</code> because of its heavy overhead running time. Based on these test results, I would not favor TensorFlow <code>Iterator</code> over my self-implemented <code>Iterator</code> in my daily TensorFlow usages. Maybe I would keep using <code>feed_dict</code> frequently simply because it looks more natural.</p>
<h2 id="Final-Remarks"><a href="#Final-Remarks" class="headerlink" title="Final Remarks"></a>Final Remarks</h2><p>TensorFlow is evolving fast. It always tries to keep up with the state-of-art deep learning research, which other deep learning frameworks usually don’t. Keep yourself updated on TensorFlow is not easy, and of course, there are many caveats when you are using the new features.</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>All the testing TensorFlow codes have been open source on my <a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo">GitHub</a>.</p>
<h3 id="Numpy-Format-MNIST-Dataset"><a href="#Numpy-Format-MNIST-Dataset" class="headerlink" title="Numpy Format MNIST Dataset"></a>Numpy Format MNIST Dataset</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_Numpy/traditional.py">Manual Instance</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_Numpy/reinitializable.py">TensorFlow Reinitializable <code>Iterator</code> Instance</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_Numpy/feedable.py">TensorFlow Feedable <code>Iterator</code> Instance</a></li>
</ul>
<h3 id="PNG-Format-MNIST-Dataset"><a href="#PNG-Format-MNIST-Dataset" class="headerlink" title="PNG Format MNIST Dataset"></a>PNG Format MNIST Dataset</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_PNG/traditional.py">Manual Instance</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_PNG/reinitializable.py">TensorFlow Reinitializable <code>Iterator</code> Instance</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/leimao/TensorFlow_Dataset_API_Demo/blob/master/MNIST_PNG/feedable.py">TensorFlow Feedable <code>Iterator</code> Instance</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Guide to TensorFlow Dataset API</p><p><a href="https://leimao.github.io/blog/TensorFlow-Dataset-API/">https://leimao.github.io/blog/TensorFlow-Dataset-API/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Lei Mao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>08-11-2018</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>08-11-2018</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <div><a class="link-muted" rel="tag" href="/tags/TensorFlow/">TensorFlow </a> </div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61b5930d440224001908310c&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered has-text-weight-normal">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="SSVSLEH4X85LU"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" href="https://www.buymeacoffee.com/leimao" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/blog/Batch-Normalization/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Batch Normalization Explained</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/Golden-Gate-Bridge/"><span class="level-item">金门大桥徒步</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comment-card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="comment-block"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://leimao.github.io/blog/TensorFlow-Dataset-API/';
            this.page.identifier = '/blog/TensorFlow-Dataset-API/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'leimao-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/author_images/Lei-Bio-Medium.jpg" alt="Lei Mao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.30rem;">Lei Mao</p><p class="is-block" style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 0.8em">Artificial Intelligence
Machine Learning
Computer Science
</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Santa Clara, California</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">453</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/leimao" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a> <a class="level-item button is-primary is-rounded" href="https://github.com/sponsors/leimao" target="_blank" rel="noopener"><i class="fas fa-heart"></i>  Sponsor</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/matchaleimao"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/lei-mao/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:dukeleimao@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="G.Scholar" href="https://scholar.google.com/citations?user=R2VUf7YAAAAJ"><i class="ai ai-google-scholar-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#TensorFlow-Dataset-API-Usages"><span class="level-left"><span class="level-item">2</span><span class="level-item">TensorFlow Dataset API Usages</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Dataset-Instance"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">Dataset Instance</span></span></a></li><li><a class="level is-mobile" href="#Iterator-Instance"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">Iterator Instance</span></span></a></li></ul></li><li><a class="level is-mobile" href="#TensorFlow-Dataset-API-Drawbacks"><span class="level-left"><span class="level-item">3</span><span class="level-item">TensorFlow Dataset API Drawbacks</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Manual-Instance"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">Manual Instance</span></span></a></li><li><a class="level is-mobile" href="#TensorFlow-Reinitializable-Iterator-Instance"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">TensorFlow Reinitializable Iterator Instance</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#TensorFlow-Feedable-Iterator-Instance"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">TensorFlow Feedable Iterator Instance</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Manual-Instance-1"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">Manual Instance</span></span></a></li><li><a class="level is-mobile" href="#TensorFlow-Reinitializable-Iterator-Instance-1"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">TensorFlow Reinitializable Iterator Instance</span></span></a></li><li><a class="level is-mobile" href="#TensorFlow-Feedable-Iterator-Instance-1"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">TensorFlow Feedable Iterator Instance</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Conclusions"><span class="level-left"><span class="level-item">4</span><span class="level-item">Conclusions</span></span></a></li><li><a class="level is-mobile" href="#Final-Remarks"><span class="level-left"><span class="level-item">5</span><span class="level-item">Final Remarks</span></span></a></li><li><a class="level is-mobile" href="#GitHub"><span class="level-left"><span class="level-item">6</span><span class="level-item">GitHub</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Numpy-Format-MNIST-Dataset"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">Numpy Format MNIST Dataset</span></span></a></li><li><a class="level is-mobile" href="#PNG-Format-MNIST-Dataset"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">PNG Format MNIST Dataset</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="g-ads-x"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3></div><br><center><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDCK3L&amp;placement=leimaogithubio" id="_carbonads_js"></script></center></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2017-2024 Lei Mao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span> <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>