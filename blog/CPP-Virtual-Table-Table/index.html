<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>C++ Virtual Table Table - Lei Mao&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Lei Mao&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon/android-chrome-192x192.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lei Mao&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="apple-touch-icon" sizes="192x192" href="/images/favicon/android-chrome-192x192.png"><link rel="apple-touch-icon" sizes="512x512" href="/images/favicon/android-chrome-512x512.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="16x16" href="/images/favicon/favicon-16x16.png"><link rel="apple-touch-icon" sizes="32x32" href="/images/favicon/favicon-32x32.png"><meta name="description" content="C++ VTables Used for Class Object Construction and Destruction"><meta property="og:type" content="blog"><meta property="og:title" content="C++ Virtual Table Table"><meta property="og:url" content="https://leimao.github.io/blog/CPP-Virtual-Table-Table/"><meta property="og:site_name" content="Lei Mao&#039;s Log Book"><meta property="og:description" content="C++ VTables Used for Class Object Construction and Destruction"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="article:published_time" content="2023-07-24T07:00:00.000Z"><meta property="article:modified_time" content="2023-07-24T07:00:00.000Z"><meta property="article:author" content="Lei Mao"><meta property="article:tag" content="CPP"><meta property="article:tag" content="Programming"><meta property="article:tag" content="CPP Compiler"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://leimao.github.io/images/favicon/android-chrome-512x512.png"><meta property="twitter:creator" content="@matchaleimao"><meta property="twitter:site" content="Lei Mao&#039;s Log Book"><meta property="fb:admins" content="dukeleimao"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://leimao.github.io/blog/CPP-Virtual-Table-Table/"},"headline":"C++ Virtual Table Table","image":["https://leimao.github.io/images/favicon/android-chrome-512x512.png"],"datePublished":"2023-07-24T07:00:00.000Z","dateModified":"2023-07-24T07:00:00.000Z","author":{"@type":"Person","name":"Lei Mao"},"publisher":{"@type":"Organization","name":"Lei Mao's Log Book","logo":{"@type":"ImageObject","url":"https://leimao.github.io/images/favicon/android-chrome-512x512.png"}},"description":"C++ VTables Used for Class Object Construction and Destruction"}</script><link rel="canonical" href="https://leimao.github.io/blog/CPP-Virtual-Table-Table/"><link rel="alternate" href="/atom.xml" title="Lei Mao&#039;s Log Book" type="application/atom+xml"><link rel="icon" href="/images/favicon/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons/css/academicons.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=PT+Sans+Narrow:wght@400;700&amp;family=PT+Serif"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-EJY6FXZBCB" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-EJY6FXZBCB');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script src="//m.servedby-buysellads.com/monetization.custom.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Lei Mao&#039;s Log Book</a><a class="navbar-item" href="/curriculum">Curriculum</a><a class="navbar-item" href="/blog">Blog</a><a class="navbar-item" href="/article">Articles</a><a class="navbar-item" href="/project">Projects</a><a class="navbar-item" href="/publication">Publications</a><a class="navbar-item" href="/reading">Readings</a><a class="navbar-item" href="/life">Life</a><a class="navbar-item" href="/essay">Essay</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/faq">FAQs</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Switch Color Scheme" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitter" href="https://gitter.im/leimao/community"><i class="fab fa-gitter"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-content"><center><div class="bsa-standard" id="carbon-ad-01"></div><script>            (function() {             if (typeof _bsa !== 'undefined' && _bsa) {                 _bsa.init('custom', 'CWYD65QY', 'placement:leimaogithubio-standard', {                     target: '#carbon-ad-01',                     template: `             <a href='##link##' class='native-banner' style='background: ##backgroundColor##' rel='sponsored noopener' target='_blank' title='##company## — ##tagline##'>                 <img class='native-img' width='125' src='##logo##' />                 <div class='native-main'>                     <div class='native-details' style='                             color: ##textColor##;                             border-left: solid 1px ##textColor##;                         '>                         <span class='native-company'>Sponsored by ##company##</span>                         <span class='native-desc'>##description##</span>                     </div>                     <span class='native-cta' style='                             color: ##ctaTextColor##;                             background-color: ##ctaBackgroundColor##;                         '>##callToAction##</span>                 </div>             </a>             `,                 });                 }             })();         </script></center></div></div><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3" style="font-family: 'PT Sans Narrow', sans-serif">C++ Virtual Table Table</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left" style="margin-bottom: 0.50rem"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2023-07-24T07:00:00.000Z" title="2023-07-24T07:00:00.000Z">07-24-2023</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2023-07-24T07:00:00.000Z" title="2023-07-24T07:00:00.000Z">07-24-2023</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/blog/">blog</a></span><span class="level-item"><i class="far fa-clock"></i> 16 minutes read (About 2440 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;visits</span></div></div><div class="content" style="margin-top: 1.0rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In my previous article <a href="/blog/CPP-Virtual-Table/">“C++ Virtual Table”</a>, we have discussed what’s vtable and how is vtable used for runtime polymorphisms in the context of non-virtual inheritance and virtual inheritance in C++.</p>
<p>There is a special concept called virtual table table, i.e., vtable table, which we did not discuss. The vtable table are static array of vtable pointers pointing to the vtables used for object construction and destruction. It only exists in the context of virtual inheritance. Some of the vtables that vtable table points to are called construction vtables, and they are only used for object construction and destruction.</p>
<p>In this blog post, I would like to discuss the C++ vtable table in detail and show a couple of examples.</p>
<h2 id="Virtual-Table-for-Construction-and-Destruction"><a href="#Virtual-Table-for-Construction-and-Destruction" class="headerlink" title="Virtual Table for Construction and Destruction"></a>Virtual Table for Construction and Destruction</h2><p>Although some programmers are not aware of it, C++ vtables are needed for object construction and destructions as well.</p>
<p>Let’s look at a quick example, even if it just uses non-virtual inheritance.</p>
<figure class="highlight c++"><figcaption><span>vtable_construction_destruction.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">A</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;A::A() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">A</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;A::~A() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="type">const</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;A::foo() is called&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="type">const</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;A::bar() is called&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">baz</span><span class="params">()</span> <span class="type">const</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;A::baz() is called&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">B</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B::B() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">B</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B::~B() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B::foo() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B::bar() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">baz</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B::baz() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> : <span class="keyword">public</span> B</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">C</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;C::C() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">foo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">C</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;C::~C() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">bar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;C::foo() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;C::bar() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">baz</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;C::baz() is called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;C Construction...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    C <span class="type">const</span>* <span class="type">const</span> ptr_c = <span class="keyword">new</span> C&#123;&#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;C Construction Complete.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    B <span class="type">const</span>* <span class="type">const</span> ptr_b = <span class="built_in">dynamic_cast</span>&lt;B <span class="type">const</span>* <span class="type">const</span>&gt;(ptr_c);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Calling baz From Base B Class Pointer...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    ptr_b-&gt;<span class="built_in">baz</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;C Destruction...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">delete</span> ptr_c;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;C Destruction complete.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;---------------------------------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The program will construct a <code>C</code> class object and destruct the <code>C</code> class object. The <code>C</code> class inherits the <code>B</code> class and the <code>B</code> class inherits the <code>A</code> class. The <code>A</code> class have three virtual functions, <code>foo()</code>, <code>bar()</code>, and <code>baz</code>. They are also overridden in both the <code>B</code> class and the <code>C</code> class. In addition, the virtual functions <code>foo()</code> and <code>bar()</code> will be called in the constructors and the destructors for each class, respectively. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ g++ vtable_construction_destruction.cpp -o vtable_construction_destruction</span><br><span class="line">$ ./vtable_construction_destruction </span><br><span class="line">---------------------------------------------</span><br><span class="line">C Construction...</span><br><span class="line">---------------------------------------------</span><br><span class="line">A::A() is called</span><br><span class="line">A::foo() is called</span><br><span class="line">B::B() is called</span><br><span class="line">B::foo() is called</span><br><span class="line">C::C() is called</span><br><span class="line">C::foo() is called</span><br><span class="line">---------------------------------------------</span><br><span class="line">C Construction Complete.</span><br><span class="line">---------------------------------------------</span><br><span class="line">Calling baz From Base B Class Pointer...</span><br><span class="line">---------------------------------------------</span><br><span class="line">C::baz() is called</span><br><span class="line">---------------------------------------------</span><br><span class="line">C Destruction...</span><br><span class="line">---------------------------------------------</span><br><span class="line">C::~C() is called</span><br><span class="line">C::bar() is called</span><br><span class="line">B::~B() is called</span><br><span class="line">B::bar() is called</span><br><span class="line">A::~A() is called</span><br><span class="line">A::bar() is called</span><br><span class="line">---------------------------------------------</span><br><span class="line">C Destruction complete.</span><br><span class="line">---------------------------------------------</span><br></pre></td></tr></table></figure>

<p>The output looks quite normal as expected. To construct a <code>C</code> class object, we will first have to construct a <code>A</code> class object followed by a <code>B</code> class object. When the virtual function <code>baz</code> is called via a <code>B</code> class pointer pointing to a <code>C</code> class object, the <code>baz</code> function overridden in C, <code>C::baz()</code>, will be called because of the runtime polymorphisms thanks to the vtable.</p>
<p>Note that during the constructor and destruction of each subobject, when <code>foo()</code> and <code>bar()</code> are called, the overriding functions in the most derived class cannot be called. For example, during the construction of the <code>A</code> class subobjct for a <code>C</code> class object, <code>A::foo()</code> was called instead of <code>C::foo()</code>. This is because when the <code>A</code> class subobject is being constructed, the <code>C</code> class object has not been constructed and calling the overriding function in the <code>C</code> class, which might modify the <code>C</code> class that has not been constructed, will result in undefined behaviors. We have three vtables related to the <code>A</code> class in this example, an <code>A</code> class vtable, a <code>B</code> class vtable which contains an <code>A</code> base class vtable, and a <code>C</code> class vtable which also contains an <code>A</code> base class vtable. During the construction of the <code>A</code> class subobject for a <code>C</code> class object, the <code>A</code> class vtable must be used. Otherwise, if the <code>B</code> class vtable which contains an <code>A</code> base class vtable or the <code>C</code> class vtable which also contains an <code>A</code> base class vtable are used, because of the function overriding, <code>A::foo()</code> would not have been called.</p>
<p>This example tells us that there can be multiple vtables used during an object construction and destruction. Those vtables are called construction (and destruction) vtables. To construct or destruct an object correctly, the right construction vtables have to be used. </p>
<h2 id="Virtual-Table-Table-for-Construction-Virtual-Table-Management"><a href="#Virtual-Table-Table-for-Construction-Virtual-Table-Management" class="headerlink" title="Virtual Table Table for Construction Virtual Table Management"></a>Virtual Table Table for Construction Virtual Table Management</h2><p>Because there can be many construction vtables during the construction and destruction of a class object, a vtable table can be created for dispatching the correct construction vtable. </p>
<p>In principle, vtable table can be used for both non-virtual inheritance and virtual inheritance. In practice, however, vtable table is only used for virtual inheritance. We will discuss these with concrete examples next.</p>
<h2 id="Non-Virtual-Inheritance"><a href="#Non-Virtual-Inheritance" class="headerlink" title="Non-Virtual Inheritance"></a>Non-Virtual Inheritance</h2><p>If a class has no virtual inheritance, during the class object construction and destruction, the base class vtables can just be used. </p>
<!-- 
This is because of a critical property of the non-virtual inheritance vtables that the offset between a vtable pointer and a virtual function is a constant in all the classes that have the virtual function.
 -->

<p>Let’s use the <a href="/blog/CPP-Virtual-Table/#Non-Virtual-Inheritance">non-virtual inheritance example</a> from my previous article <a href="/blog/CPP-Virtual-Table/">“C++ Virtual Table”</a>, we have the following inheritance diagram.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fruit</span><br><span class="line">  |</span><br><span class="line">Apple</span><br></pre></td></tr></table></figure>

<p>The vtables for the <code>Fruit</code> class and the <code>Apple</code> class are demonstrated below. </p>
<!-- 

We could see that, for example, the `Fruit` class object vtable pointer (`16`) and the virtual function `Fruit::bar` entry (`40`) has an offset 
 -->

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Fruit</span><br><span class="line">Fruit::_ZTV5Fruit: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">16    0</span><br><span class="line">24    0</span><br><span class="line">32    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Apple</span><br><span class="line">Apple::_ZTV5Apple: 7 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">16    (int (*)(...))Apple::~Apple</span><br><span class="line">24    (int (*)(...))Apple::~Apple</span><br><span class="line">32    (int (*)(...))Apple::foo</span><br><span class="line">40    (int (*)(...))Fruit::bar</span><br><span class="line">48    (int (*)(...))Apple::apple_foo</span><br></pre></td></tr></table></figure>

<p>To construct an <code>Apple</code> class object, we will construct a <code>Fruit</code> class subobject first. The <code>Fruit</code> class vtable <code>Fruit::_ZTV5Fruit</code> can just be reused. The <code>Fruit</code> class subobject vtable pointer will just point to the <code>Fruit</code> class vtable <code>Fruit::_ZTV5Fruit</code> and use the virtual functions there if necessary. Once the <code>Fruit</code> class subobject construction is complete, the <code>Apple</code> class object vtable pointer, which is at the same memory address as the <code>Fruit</code> class subobject vtable pointer, will point to the <code>Apple</code> class vtable <code>Apple::_ZTV5Apple</code> and use the virtual functions there if necessary. </p>
<p>Everything seems to be very straightforward. If all the inheritances in C++ are non-virtual, nobody will come up with an idea of vtable table as it’s not needed.</p>
<h2 id="Virtual-Inheritance"><a href="#Virtual-Inheritance" class="headerlink" title="Virtual Inheritance"></a>Virtual Inheritance</h2><p>If a class has virtual inheritance, during the class object construction and destruction, the base class vtables cannot always be used.</p>
<p>Let’s use the <a href="/blog/CPP-Virtual-Table-Table/#Virtual-Inheritance">virtual inheritance example</a> from my previous article <a href="/blog/CPP-Virtual-Table/">“C++ Virtual Table”</a>, we have the following inheritance diagram.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Item</span><br><span class="line">  |</span><br><span class="line">Fruit</span><br><span class="line">  |</span><br><span class="line">Apple</span><br></pre></td></tr></table></figure>

<p>The vtables for the <code>Item</code> class, the <code>Fruit</code> class and the <code>Apple</code> class are demonstrated below. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Item</span><br><span class="line">Item::_ZTV4Item: 6 entries</span><br><span class="line">0     (int (*)(...))0</span><br><span class="line">8     (int (*)(...))(&amp; _ZTI4Item)</span><br><span class="line">16    (int (*)(...))Item::~Item</span><br><span class="line">24    (int (*)(...))Item::~Item</span><br><span class="line">32    (int (*)(...))Item::qux</span><br><span class="line">40    (int (*)(...))Item::quux</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Fruit</span><br><span class="line">Fruit::_ZTV5Fruit: 17 entries</span><br><span class="line">0     24</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    18446744073709551592</span><br><span class="line">72    0</span><br><span class="line">80    18446744073709551592</span><br><span class="line">88    (int (*)(...))-24</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Item::qux</span><br><span class="line">128   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Vtable for Apple</span><br><span class="line">Apple::_ZTV5Apple: 18 entries</span><br><span class="line">0     32</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">24    (int (*)(...))Apple::~Apple</span><br><span class="line">32    (int (*)(...))Apple::~Apple</span><br><span class="line">40    (int (*)(...))Apple::foo</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    (int (*)(...))Apple::apple_foo</span><br><span class="line">72    18446744073709551584</span><br><span class="line">80    0</span><br><span class="line">88    18446744073709551584</span><br><span class="line">96    (int (*)(...))-32</span><br><span class="line">104   (int (*)(...))(&amp; _ZTI5Apple)</span><br><span class="line">112   (int (*)(...))Apple::_ZTv0_n24_N5AppleD1Ev</span><br><span class="line">120   (int (*)(...))Apple::_ZTv0_n24_N5AppleD0Ev</span><br><span class="line">128   (int (*)(...))Item::qux</span><br><span class="line">136   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br></pre></td></tr></table></figure>



<p>To construct an <code>Apple</code> class object, we will construct a <code>Item</code> class virtual base subobject first. The <code>Item</code> class vtable <code>Item::_ZTV4Item</code> can just be reused. Not a problem.</p>
<p>However, when it comes to constructing a <code>Fruit</code> class subobject, we got a problem that the <code>Fruit</code> class vtable <code>Fruit::_ZTV5Fruit</code> cannot be reused. Suppose we insist using the <code>Fruit</code> class vtable <code>Fruit::_ZTV5Fruit</code> for the <code>Fruit</code> class subobject construction, the <code>Fruit</code> class subobject vtable pointer will point to offset <code>24</code>. This has no problem. If the <code>Fruit</code> class constructor has to call the virtual function <code>qux</code> declared in the virtual base <code>Item</code> class. The virtual base <code>Item</code> class subobject vtable pointer will have to be found first. Its offset from the <code>Fruit</code> class subobject vtable pointer, which points to the vtable <code>Fruit::_ZTV5Fruit</code> at offset <code>104</code>, can be queried from the vtable <code>Fruit::_ZTV5Fruit</code> vbase-offset at offset <code>0</code>, which is <code>24</code>. Then <code>Item::qux</code> will be invoked. The problem is, the <code>Item</code> class subobject vtable pointer offset from the the <code>Fruit</code> class subobject vtable pointer, which is <code>24</code> according to the vbase-offset we just obtained, is incorrect. The correct vbase-offset value, which we could peek from the <code>Apple</code> class vtable <code>Apple::_ZTV5Apple</code>, is <code>32</code>. Fundamentally, this is due to the vtable layout of the virtual inheritance vtable is different from the vtable layout of the non-virtual inheritance vtable.</p>
<p>To fix this problem, we will need a new vtable for the <code>Fruit</code> class in the <code>Apple</code> class, which is called the construction vtable for <code>Fruit</code> in <code>Apple</code> demonstrated below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Construction vtable for Fruit (0x0x7fa3f5c0e5b0 instance) in Apple</span><br><span class="line">Apple::_ZTC5Apple0_5Fruit: 17 entries</span><br><span class="line">0     32</span><br><span class="line">8     (int (*)(...))0</span><br><span class="line">16    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">24    0</span><br><span class="line">32    0</span><br><span class="line">40    (int (*)(...))__cxa_pure_virtual</span><br><span class="line">48    (int (*)(...))Fruit::bar</span><br><span class="line">56    (int (*)(...))Fruit::quux</span><br><span class="line">64    18446744073709551584</span><br><span class="line">72    0</span><br><span class="line">80    18446744073709551584</span><br><span class="line">88    (int (*)(...))-32</span><br><span class="line">96    (int (*)(...))(&amp; _ZTI5Fruit)</span><br><span class="line">104   0</span><br><span class="line">112   0</span><br><span class="line">120   (int (*)(...))Item::qux</span><br><span class="line">128   (int (*)(...))Fruit::_ZTv0_n40_N5Fruit4quuxEv</span><br></pre></td></tr></table></figure>

<p>Using this vtable, we can correctly construct or destruct the <code>Fruit</code> class subobject inside an <code>Apple</code> class subject. This vtable is only used for construction and destruction.</p>
<p>When the <code>Fruit</code> class is inherited by multiple different classes, there will be multiple different construction vtable for <code>Fruit</code> in different classes. When the number of such classes, the construction vtable management becomes complicated.</p>
<p>Because of this, the vtable table comes into play. For each class that has virtual inheritance, there is a vtable table so that the correct vtables can be dispatched during the class object construction and destruction.</p>
<p>In our example, the vtable table for the <code>Apple</code> class is demonstrated below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VTT for Apple</span><br><span class="line">Apple::_ZTT5Apple: 4 entries</span><br><span class="line">0     ((&amp; Apple::_ZTV5Apple) + 24)</span><br><span class="line">8     ((&amp; Apple::_ZTC5Apple0_5Fruit) + 24)</span><br><span class="line">16    ((&amp; Apple::_ZTC5Apple0_5Fruit) + 104)</span><br><span class="line">24    ((&amp; Apple::_ZTV5Apple) + 112)</span><br></pre></td></tr></table></figure>

<p>It consists of four vtable pointers that point to two vtables, including <code>Apple::_ZTV5Apple</code> and <code>Apple::_ZTC5Apple0_5Fruit</code>.</p>
<p>The summary of the <code>Apple</code> class and vtable information are shown below.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class Apple</span><br><span class="line">   size=48 align=8</span><br><span class="line">   base size=28 base align=8</span><br><span class="line">Apple (0x0x7fa3f5c0e548) 0</span><br><span class="line">    vptridx=0 vptr=((&amp; Apple::_ZTV5Apple) + 24)</span><br><span class="line">Fruit (0x0x7fa3f5c0e5b0) 0</span><br><span class="line">      primary-for Apple (0x0x7fa3f5c0e548)</span><br><span class="line">      subvttidx=8</span><br><span class="line">Item (0x0x7fa3f5d6dde0) 32 virtual</span><br><span class="line">        vptridx=24 vbaseoffset=-24 vptr=((&amp; Apple::_ZTV5Apple) + 112)</span><br></pre></td></tr></table></figure>

<p><code>Apple (0x0x7fa3f5c0e548) 0</code> says the <code>Apple</code> class vtable pointer <code>vptr</code> points to <code>((&amp; Apple::_ZTV5Apple) + 24)</code> and its offset in the vtable table <code>vptridx</code> is <code>0</code>. That is to say, <code>vptr = *(&amp; Apple::_ZTT5Apple + vptridx) = ((&amp; Apple::_ZTV5Apple) + 24)</code>.</p>
<p><code>Fruit (0x0x7fa3f5c0e5b0) 0</code> says the <code>Fruit</code> class is the primary base class for <code>Apple</code> so that it shares the vtable pointer <code>vptr</code> with the <code>Apple</code> class. The construction vtable pointer offset in the vtable table <code>subvttidx</code> is <code>8</code>, which means the <code>Fruit</code> class in the <code>Apple</code> class uses the vtable pointer <code>*(&amp; Apple::_ZTT5Apple + subvttidx) = ((&amp; Apple::_ZTC5Apple0_5Fruit) + 24)</code> for construction and destruction. In fact, the first line in the construction vtable <code>Construction vtable for Fruit (0x0x7fa3f5c0e5b0 instance) in Apple</code> already showed the instance ID for <code>Fruit</code> in <code>Apple</code> which is <code>0x0x7fa3f5c0e5b0</code> and it is consistent with the one in <code>Fruit (0x0x7fa3f5c0e5b0) 0</code>.</p>
<p><code>Item (0x0x7fa3f5d6dde0) 32 virtual</code> says the virtual base <code>Item</code> class vtable pointer <code>vptr</code> points to <code>((&amp; Apple::_ZTV5Apple) + 112)</code> and the pointer pointing to the <code>vptr</code> offset in the vtable table <code>vptridx</code> is <code>24</code>. That is to say, <code>vptr = *(&amp; Apple::_ZTT5Apple + vptridx) = ((&amp; Apple::_ZTV5Apple) + 112)</code>. The <code>vbaseoffset</code> in this case is a little bit confusing. It does not mean the <code>Apple</code> class (vtable) pointer or the <code>Fruit</code> class  (vtable) pointer offset to the <code>Item</code> class (vtable) pointer is <code>-24</code>. In fact, they should be <code>32</code> as we could see from the <code>Apple</code> class vtable <code>Apple::_ZTV5Apple</code>. Instead, it actually means in the vtable of the class which virtually inherits the <code>Item</code> class in the <code>Apple</code> class, the offset between the vtable pointer <code>vptr</code> and the vbase-offset entry is <code>-24</code>. That’s to say, to find the vbase-offset value given a vtable pointer <code>vptr</code>, the vbase-offset value is <code>*(vptr - 24)</code>.</p>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><p>We have discussed the motivation of using vtable in virtual inheritance and how it is used for object construction and destruction. But notice that we have never discussed how a vtable or a vtable table is constructed by the compiler, we just used whatever vtable and vtable table constructed by the compiler in this article. </p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://isocpp.org/wiki/faq/multiple-inheritance#virtual-inheritance-ctors">ISO C++ FAQ</a></li>
<li><a target="_blank" rel="noopener" href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable-components">Itanium C++ ABI - Virtual Table Components and Order</a></li>
<li><a target="_blank" rel="noopener" href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html#vtable-construction">Itanium C++ ABI - Virtual Table Construction</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6258559/what-is-the-vtt-for-a-class">What is the VTT for a class?</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>C++ Virtual Table Table</p><p><a href="https://leimao.github.io/blog/CPP-Virtual-Table-Table/">https://leimao.github.io/blog/CPP-Virtual-Table-Table/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Lei Mao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>07-24-2023</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>07-24-2023</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <div><a class="link-muted" rel="tag" href="/tags/CPP/">CPP,</a> </div><div><a class="link-muted" rel="tag" href="/tags/Programming/">Programming,</a> </div><div><a class="link-muted" rel="tag" href="/tags/CPP-Compiler/">CPP Compiler </a> </div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=61b5930d440224001908310c&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered has-text-weight-normal">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" data-type="paypal" onclick="document.getElementById(&#039;paypal-donate-form&#039;).submit()"><span class="icon is-small"><i class="fab fa-paypal"></i></span><span>Paypal</span></a><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" rel="noopener" id="paypal-donate-form"><input type="hidden" name="cmd" value="_donations"><input type="hidden" name="business" value="SSVSLEH4X85LU"><input type="hidden" name="currency_code" value="USD"></form><a class="button donate" href="https://www.buymeacoffee.com/leimao" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/essay/%E4%B8%87%E4%BB%A3%E5%AE%98%E6%96%B9%E9%A2%84%E8%B4%AD%E7%BD%91%E7%AB%99-Premium-Bandai/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">万代官方预购网站 Premium Bandai</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/Milpitas-Parks/"><span class="level-item">Milpitas Parks 徒步</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comment-card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="comment-block"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://leimao.github.io/blog/CPP-Virtual-Table-Table/';
            this.page.identifier = '/blog/CPP-Virtual-Table-Table/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'leimao-github-io' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/author_images/Lei-Bio-Medium.jpg" alt="Lei Mao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.30rem;">Lei Mao</p><p class="is-block" style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 0.8em">Artificial Intelligence
Machine Learning
Computer Science
</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Santa Clara, California</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">733</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">7</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">453</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/leimao" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a> <a class="level-item button is-primary is-rounded" href="https://github.com/sponsors/leimao" target="_blank" rel="noopener"><i class="fas fa-heart"></i>  Sponsor</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/leimao"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/matchaleimao"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/lei-mao/"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:dukeleimao@gmail.com"><i class="fas fa-envelope-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="G.Scholar" href="https://scholar.google.com/citations?user=R2VUf7YAAAAJ"><i class="ai ai-google-scholar-square"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#Virtual-Table-for-Construction-and-Destruction"><span class="level-left"><span class="level-item">2</span><span class="level-item">Virtual Table for Construction and Destruction</span></span></a></li><li><a class="level is-mobile" href="#Virtual-Table-Table-for-Construction-Virtual-Table-Management"><span class="level-left"><span class="level-item">3</span><span class="level-item">Virtual Table Table for Construction Virtual Table Management</span></span></a></li><li><a class="level is-mobile" href="#Non-Virtual-Inheritance"><span class="level-left"><span class="level-item">4</span><span class="level-item">Non-Virtual Inheritance</span></span></a></li><li><a class="level is-mobile" href="#Virtual-Inheritance"><span class="level-left"><span class="level-item">5</span><span class="level-item">Virtual Inheritance</span></span></a></li><li><a class="level is-mobile" href="#Conclusions"><span class="level-left"><span class="level-item">6</span><span class="level-item">Conclusions</span></span></a></li><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">7</span><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget"><div class="g-ads-x"><div class="card-content"><div class="menu"><h3 class="menu-label">Advertisement</h3></div><br><center><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDCK3L&amp;placement=leimaogithubio" id="_carbonads_js"></script></center></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon/android-chrome-512x512.png" alt="Lei Mao&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2017-2024 Lei Mao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span> <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/leimao"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>